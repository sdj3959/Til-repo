# 0728 í•™ìŠµë‚´ìš© ì •ë¦¬

---

## ğŸ§ª JPA í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±ë²•

### ğŸ”¹ ì–´ë…¸í…Œì´ì…˜ ì„¤ëª…

* `@SpringBootTest`: Spring Container ì „ì²´ë¥¼ ë¡œë”© (ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ëª©ì  X)
* `@DataJpaTest`: Repository í…ŒìŠ¤íŠ¸ì— ìµœì í™”ëœ ì–´ë…¸í…Œì´ì…˜

  * `@Repository` ê´€ë ¨ ë¹ˆë§Œ ë¡œë“œ
  * ìë™ìœ¼ë¡œ ë¡¤ë°±
  * **ë‚´ì¥ DBë§Œ ì‚¬ìš© ê°€ëŠ¥(H2 ë“±)**

### ğŸ”¹ Product í…ŒìŠ¤íŠ¸ íë¦„

#### 1. ì‚¬ì „ ì €ì¥

```java
@BeforeEach
void insertBefore() {
    Product p1 = Product.builder().name("ì•„ì´í°").category(ELECTRONIC).price(2000000).build();
    Product p2 = Product.builder().name("íƒ•ìˆ˜ìœ¡").category(FOOD).price(20000).build();
    Product p3 = Product.builder().name("êµ¬ë‘").category(FASHION).price(300000).build();
    Product p4 = Product.builder().name("ì£¼ë¨¹ë°¥").category(FOOD).price(1500).build();
    productJpaRepository.saveAllAndFlush(List.of(p1,p2,p3,p4));
}
```

#### 2. CRUD í…ŒìŠ¤íŠ¸ ì˜ˆì‹œ

* ì €ì¥: `save()` â†’ ì €ì¥ëœ ê°ì²´ ë°˜í™˜
* ì‚­ì œ: `deleteById(id)`
* ë‹¨ì¼ì¡°íšŒ: `findById(id)` â†’ Optional ì‚¬ìš©
* ìˆ˜ì •: ê°ì²´ ìˆ˜ì • í›„ ë‹¤ì‹œ `save()` â†’ UPDATE ì‹¤í–‰ë¨
* ì „ì²´ì¡°íšŒ: `findAll()` â†’ List ë°˜í™˜

### ğŸ”¹ Product í´ë˜ìŠ¤ ì£¼ìš” êµ¬ì„±

* `@Entity`, `@Table(name = "tbl_product")`
* `@Id` + `@GeneratedValue`
* `@CreationTimestamp`, `@UpdateTimestamp`
* `@Enumerated(EnumType.STRING)`ìœ¼ë¡œ enumê°’ ëª…ì‹œì  ì €ì¥
* í¸ì˜ ë©”ì„œë“œ: `changeProduct()`

---

## ğŸ“š JPA ì‹¤ìŠµ: Student ì˜ˆì œ

### ğŸ”¹ ì—”í‹°í‹° êµ¬ì¡°

```java
@Entity
@Table(name = "tbl_student")
public class Student {
    @Id @GeneratedValue(strategy = GenerationType.UUID)
    private String id;
    private String name;
    private String city;
    private String major;
}
```

### ğŸ”¹ Repository: Query Method ì˜ˆì‹œ

```java
List<Student> findByName(String name);
List<Student> findByCityAndMajor(String city, String major);
List<Student> findByMajorContaining(String major);
List<Student> findByMajorStartingWith(String major);
List<Student> findByMajorEndingWith(String major);
```

* ê·œì¹™ ê¸°ë°˜ ì¿¼ë¦¬ ë©”ì„œë“œë¥¼ í†µí•´ ìë™ìœ¼ë¡œ SQL ìƒì„±

---

## ğŸ—‚ï¸ SQL JOIN ë¬¸ ë³µìŠµ

### ğŸ”¹ NATURAL JOIN

* ê³µí†µ ì»¬ëŸ¼ ê¸°ì¤€ ìë™ ì¡°ì¸
* ë³„ì¹­ ì‚¬ìš© ì‹œ ì£¼ì˜ (ì»¬ëŸ¼ ì´ë¦„ ê·¸ëŒ€ë¡œ ìœ ì§€í•´ì•¼ ì‘ë™)

```sql
SELECT USER_ID, U.USERNAME, U.EMAIL, UP.FULL_NAME
FROM USERS U
NATURAL JOIN USER_PROFILES UP;
```

### ğŸ”¹ USING JOIN

```sql
SELECT USER_ID, U.USERNAME, U.EMAIL, UP.FULL_NAME
FROM USERS U
JOIN USER_PROFILES UP USING (USER_ID);
```

### ğŸ”¹ SELF JOIN

```sql
SELECT U1.USER_ID, U1.USERNAME, U1.MANAGER_ID,
       NVL(U2.USERNAME, 'ìƒì‚¬ì—†ìŒ') AS MANAGER_NAME
FROM USERS U1
LEFT JOIN USERS U2
ON U1.MANAGER_ID = U2.USER_ID;
```

### ğŸ”¹ ì§‘í•© ì—°ì‚°ì

* `UNION`: í•©ì§‘í•© (ì¤‘ë³µ ì œê±°)
* `UNION ALL`: ì¤‘ë³µ í—ˆìš©
* `INTERSECT`: êµì§‘í•©
* `MINUS`: ì°¨ì§‘í•©

```sql
-- ì¢‹ì•„ìš”ì™€ ëŒ“ê¸€ ì‘ì„±ì ID êµì§‘í•©
SELECT USER_ID FROM LIKES
INTERSECT
SELECT USER_ID FROM COMMENTS;
```

---

## âœ… ìš”ì•½

* JPAì—ì„œ CRUDëŠ” `save`, `findById`, `deleteById` ë“±ìœ¼ë¡œ ìˆ˜í–‰ ê°€ëŠ¥í•˜ë©°, ìˆ˜ì •ì€ ì¡°íšŒ í›„ í•„ë“œ ë³€ê²½ + `save()`ë¡œ ì²˜ë¦¬
* `@DataJpaTest`ëŠ” JPA Repository í…ŒìŠ¤íŠ¸ì— íŠ¹í™”ëœ ì–´ë…¸í…Œì´ì…˜
* Query MethodëŠ” ì´ë¦„ë§Œìœ¼ë¡œ SQLì„ ìë™ ìƒì„±í•˜ì—¬ ê°„ë‹¨í•œ ì¡°ê±´ ê²€ìƒ‰ì´ ê°€ëŠ¥
* SQL JOINë¬¸(NATURAL, USING, SELF JOIN)ê³¼ ì§‘í•© ì—°ì‚°ì(UNION, INTERSECT ë“±)ë„ ì‹¤ìŠµì„ í†µí•´ ë³µìŠµ
