## 0915 Full-Stack: Real-time Chat with WebSocket, STOMP & JWT

---

### β… 1. λ°±μ—”λ“(BE): μ‹¤μ‹κ°„ ν†µμ‹  μ±„λ„ κµ¬μ¶• (WebSocket & STOMP)

*   HTTPμ λ‹¨λ°©ν–¥, λΉ„μ—°κ²°μ„± ν•κ³„λ¥Ό κ·Ήλ³µν•κ³  μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈ κ°„μ **μ§€μ†μ μΈ μ–‘λ°©ν–¥ ν†µμ‹ **μ„ κµ¬ν„ν•κΈ° μ„ν•΄ WebSocket κΈ°μ μ„ λ„μ…ν–μµλ‹λ‹¤.

#### β• μ£Όμ” κ°λ…

1.  **WebSocket**:
    *   **κ°λ…**: ν•λ‚μ TCP μ—°κ²° μ„μ—μ„ ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°€ μ‹¤μ‹κ°„μΌλ΅ λ°μ΄ν„°λ¥Ό μ£Όκ³ λ°›μ„ μ μκ² ν•΄μ£Όλ” ν†µμ‹  ν”„λ΅ν† μ½μ…λ‹λ‹¤. μµμ΄ μ—°κ²° μ‹μ—λ§ HTTPλ¥Ό μ‚¬μ©ν•κ³ , μ΄ν›„μ—λ” λ…λ¦½μ μΈ WebSocket ν”„λ΅ν† μ½λ΅ ν†µμ‹ ν•©λ‹λ‹¤.
    *   **μ—­ν• **: μ‹¤μ‹κ°„ μ±„ν…, μ•λ¦Ό, μ£Όμ‹ μ‹μ„Έ λ“± μ„λ²„μ λ°μ΄ν„° λ³€κ²½μ„ μ¦‰μ‹ ν΄λΌμ΄μ–ΈνΈμ— μ•λ ¤μ¤μ•Ό ν•λ” κΈ°λ¥μ κΈ°λ°μ΄ λ©λ‹λ‹¤.

2.  **STOMP (Simple Text Oriented Messaging Protocol)**:
    *   **κ°λ…**: WebSocket μ„μ—μ„ λ™μ‘ν•λ” λ” λ†’μ€ μμ¤€μ **λ©”μ‹μ§• ν”„λ΅ν† μ½**μ…λ‹λ‹¤. μμν• WebSocket ν†µμ‹ μ€ λ§¤μ° μ €μμ¤€μ΄λΌ λ‹¤λ£¨κΈ° λ³µμ΅ν•μ§€λ§, STOMPλ” **"κµ¬λ…(Subscribe)"**κ³Ό **"λ°ν–‰(Publish)"**μ΄λΌλ” μ§κ΄€μ μΈ λ¨λΈμ„ μ κ³µν•μ—¬ λ©”μ‹μ§€ νλ¦„μ„ μ‰½κ² κ΄€λ¦¬ν•  μ μκ² ν•΄μ¤λ‹λ‹¤.
    *   **μ£Όμ” κµ¬μ„±**:
        *   **Message Broker**: λ©”μ‹μ§€λ¥Ό λ°ν–‰μ(Publisher)λ΅λ¶€ν„° λ°›μ•„ κµ¬λ…μ(Subscriber)μ—κ² μ „λ‹¬ν•λ” μ¤‘κ°„ κ΄€λ¦¬μ μ—­ν• μ„ ν•©λ‹λ‹¤. (e.g., `/topic`, `/queue`)
        *   **Endpoint**: ν΄λΌμ΄μ–ΈνΈκ°€ WebSocket μ—°κ²°μ„ μ‹μ‘ν•λ” κ²½λ΅μ…λ‹λ‹¤. (e.g., `/ws`)
    *   **`WebSocketConfig`**: Springμ—μ„ STOMP μ—”λ“ν¬μΈνΈμ™€ λ©”μ‹μ§€ λΈλ΅μ»¤λ¥Ό μ„¤μ •ν•λ” Java μ„¤μ • ν΄λμ¤μ…λ‹λ‹¤.

---

### β… 2. λ°±μ—”λ“(BE): WebSocket μ—°κ²° λ³΄μ• (JWT μΈμ¦)

*   **λ¬Έμ μ **: WebSocket μ—°κ²°μ€ ν•λ² μλ¦½λλ©΄ κ³„μ† μ μ§€λλ―€λ΅, μ΄ μ—°κ²°μ΄ **λ„κµ¬λ΅λ¶€ν„° μ¨ κ²ƒμΈμ§€ μΈμ¦**ν•λ” κ²ƒμ΄ λ§¤μ° μ¤‘μ”ν•©λ‹λ‹¤.
*   **ν•΄κ²°μ±… (Handshake Interceptor)**: WebSocket μ—°κ²°μ€ μµμ΄μ— HTTP ν”„λ΅ν† μ½μ„ ν†µν•΄ **"ν•Έλ“μ…°μ΄ν¬(Handshake)"** κ³Όμ •μ„ κ±°μ³ μλ¦½λ©λ‹λ‹¤. μ΄ ν•Έλ“μ…°μ΄ν¬ μ”μ²­μ„ κ°€λ΅μ±„λ” **μΈν„°μ…‰ν„°**λ¥Ό κµ¬ν„ν•μ—¬ JWT μΈμ¦μ„ μν–‰ν–μµλ‹λ‹¤.

#### β• μΈμ¦ νλ¦„

1.  ν΄λΌμ΄μ–ΈνΈκ°€ WebSocket μ—°κ²°μ„ μ‹λ„ν•λ©΄, λΈλΌμ°μ €λ” κΈ°μ΅΄μ— μ €μ¥λ **`Http-Only` μΏ ν‚¤(JWT ν¬ν•¨)**λ¥Ό ν•Έλ“μ…°μ΄ν¬ μ”μ²­μ— ν•¨κ» λ³΄λƒ…λ‹λ‹¤.
2.  μ„λ²„μ **`CookieAuthHandshakeInterceptor`**κ°€ μ΄ μ”μ²­μ„ κ°€λ΅μ±•λ‹λ‹¤.
3.  μΈν„°μ…‰ν„°λ” μΏ ν‚¤μ—μ„ Access Tokenμ„ μ¶”μ¶ν•μ—¬ μ ν¨μ„±μ„ κ²€μ¦ν•©λ‹λ‹¤.
4.  κ²€μ¦μ— μ„±κ³µν•λ©΄, ν•΄λ‹Ή μ‚¬μ©μ μ •λ³΄λ¥Ό **WebSocket μ„Έμ…**μ— μ•μ „ν•κ² μ—°κ²°ν•©λ‹λ‹¤.
5.  μ΄ν›„ ν•΄λ‹Ή WebSocket μ—°κ²°μ„ ν†µν•΄ λ“¤μ–΄μ¤λ” λ¨λ“  λ©”μ‹μ§€λ” μ΄ μΈμ¦λ μ‚¬μ©μμ λ©”μ‹μ§€λ΅ κ°„μ£Όλ©λ‹λ‹¤.
6.  **`WebSocketSecurityConfig`**λ¥Ό ν†µν•΄, νΉμ • STOMP κ²½λ΅(e.g., λ©”μ‹μ§€ μ „μ†΅)λ” μΈμ¦λ μ‚¬μ©μλ§ μ ‘κ·Όν•  μ μλ„λ΅ μ¶”κ°€μ μΈ λ³΄μ•μ„ μ„¤μ •ν–μµλ‹λ‹¤.

---

### β… 3. λ°±μ—”λ“(BE): ν•μ΄λΈλ¦¬λ“ μ±„ν… λ°μ΄ν„° μ κ³µ (REST + WebSocket)

*   ν¨μ¨μ μΈ μ±„ν…λ°© κ²½ν—μ„ μ κ³µν•κΈ° μ„ν•΄, κ³Όκ±° λ©”μ‹μ§€ μ΅°νμ™€ μ‹¤μ‹κ°„ λ©”μ‹μ§€ μμ‹ μ„ λ‘ κ°€μ§€ λ‹¤λ¥Έ λ°©μ‹μΌλ΅ κµ¬ν„ν–μµλ‹λ‹¤.

1.  **κ³Όκ±° λ©”μ‹μ§€ μ΅°ν (REST API)**:
    *   μ‚¬μ©μκ°€ μ±„ν…λ°©μ— μ²μ μ…μ¥ν–μ„ λ•, μ΄μ „μ— μ“μΈ λ€ν™” λ‚΄μ©μ„ λ³΄μ—¬μ£ΌκΈ° μ„ν•΄ **νμ΄μ§€λ„¤μ΄μ…(Pagination)**μ΄ μ μ©λ REST API(`GET /api/chat/rooms/{roomId}/messages`)λ¥Ό κµ¬ν„ν–μµλ‹λ‹¤.
    *   ν΄λΌμ΄μ–ΈνΈλ” μ΄ APIλ¥Ό νΈμ¶ν•μ—¬ μ΄κΈ° λ€ν™” λ©λ΅μ„ λ¶λ¬μµλ‹λ‹¤.

2.  **μ‹¤μ‹κ°„ λ©”μ‹μ§€ μ „μ†΅ λ° μμ‹  (WebSocket)**:
    *   **`@MessageMapping`**: ν΄λΌμ΄μ–ΈνΈκ°€ νΉμ • STOMP λ©μ μ§€(e.g., `/app/chat.sendMessage`)λ΅ λ©”μ‹μ§€λ¥Ό λ³΄λ‚΄λ©΄, μ΄ μ–΄λ…Έν…μ΄μ…μ΄ λ¶™μ€ μ»¨νΈλ΅¤λ¬ λ©”μ„λ“κ°€ λ©”μ‹μ§€λ¥Ό μμ‹ ν•©λ‹λ‹¤.
    *   **λΈλ΅λ“μΊμ¤ν…(Broadcasting)**: μ»¨νΈλ΅¤λ¬λ” μμ‹ ν• λ©”μ‹μ§€λ¥Ό DBμ— μ €μ¥ν• ν›„, ν•΄λ‹Ή μ±„ν…λ°©μ„ κµ¬λ…ν•κ³  μλ” λ¨λ“  ν΄λΌμ΄μ–ΈνΈμ—κ² λ©”μ‹μ§€ λΈλ΅μ»¤λ¥Ό ν†µν•΄(e.g., `/topic/room/{roomId}`) λ‹¤μ‹ μ „μ†΅(λΈλ΅λ“μΊμ¤νΈ)ν•©λ‹λ‹¤.

---

### β… 4. ν”„λ΅ νΈμ—”λ“(FE): μ±„ν… ν΄λΌμ΄μ–ΈνΈ κµ¬ν„

*   λ°±μ—”λ“μ—μ„ κµ¬μ¶•ν• μ‹¤μ‹κ°„ ν†µμ‹  μ±„λ„κ³Ό APIλ¥Ό ν™μ©ν•μ—¬, μ‚¬μ©μκ°€ μ‹¤μ λ΅ μ±„ν…μ„ μ£Όκ³ λ°›μ„ μ μλ” UIμ™€ λ΅μ§μ„ κµ¬ν„ν–μµλ‹λ‹¤.

#### β• μ£Όμ” κ°λ…

1.  **WebSocket μ—°κ²° κ΄€λ¦¬ (`websocketService.js`)**:
    *   WebSocket μ—°κ²°, κµ¬λ…, λ©”μ‹μ§€ μ „μ†΅, μ—°κ²° ν•΄μ  λ“± λ³µμ΅ν• λ΅μ§μ„ λ³„λ„μ **μ„λΉ„μ¤ νμΌλ΅ μ¶”μƒν™”**ν•μ—¬ μ»΄ν¬λ„νΈμ λ³µμ΅λ„λ¥Ό λ‚®μ·„μµλ‹λ‹¤.
    *   λ„¤νΈμ›ν¬ λ¶μ•μ • λ“±μ— λ€λΉ„ν•μ—¬ **μλ™ μ¬μ—°κ²°** λ΅μ§μ„ ν¬ν•¨ν•μ—¬ μ•μ •μ„±μ„ λ†’μ€μµλ‹λ‹¤.

2.  **μ±„ν… UI μ»΄ν¬λ„νΈ**:
    *   `MessageList`: μ±„ν… λ©”μ‹μ§€ λ©λ΅μ„ λ λ”λ§ν•λ” μ»΄ν¬λ„νΈ.
    *   `MessageItem`: κ°λ³„ λ©”μ‹μ§€ λ²„λΈ” UI.
    *   `MessageInput`: μ‚¬μ©μκ°€ λ©”μ‹μ§€λ¥Ό μ…λ ¥ν•κ³  μ „μ†΅(Enter) λλ” μ¤„λ°”κΏ(Shift+Enter)ν•  μ μλ” μ…λ ¥ μ»΄ν¬λ„νΈ.

3.  **λ°μ΄ν„° λ™κΈ°ν™” νλ¦„**:
    *   **[μ§„μ…]** μ±„ν…λ°© μƒμ„Έ νμ΄μ§€(`RoomDetail`)μ— μ§„μ…ν•λ©΄, **λ¨Όμ € REST APIλ¥Ό νΈμ¶**ν•μ—¬ κ³Όκ±° λ€ν™” κΈ°λ΅μ„ κ°€μ Έμ™€ ν™”λ©΄μ— λ λ”λ§ν•©λ‹λ‹¤.
    *   **[μ—°κ²°]** λ™μ‹μ—, `websocketService`λ¥Ό ν†µν•΄ WebSocketμ— μ—°κ²°ν•κ³  ν•΄λ‹Ή μ±„ν…λ°©μ STOMP ν† ν”½μ„ **κµ¬λ…**ν•©λ‹λ‹¤.
    *   **[μ‹¤μ‹κ°„]** λ‹¤λ¥Έ μ‚¬μ©μκ°€ λ³΄λ‚Έ λ©”μ‹μ§€κ°€ λΈλ΅λ“μΊμ¤νΈλλ©΄, κµ¬λ… μ¤‘μΈ ν΄λΌμ΄μ–ΈνΈκ°€ μ΄λ¥Ό μμ‹ ν•μ—¬ κΈ°μ΅΄ λ©”μ‹μ§€ λ©λ΅μ— **μ‹¤μ‹κ°„μΌλ΅ μ¶”κ°€**ν•©λ‹λ‹¤.
    *   **[κ¶ν•]** μ¤ν„°λ””λ£Έμ— μ°Έμ—¬ν• μ‚¬μ©μλ§ μ±„ν… μ…λ ¥μ°½μ΄ λ³΄μ΄λ„λ΅ μ΅°κ±΄λ¶€ λ λ”λ§μ„ μ μ©ν–μµλ‹λ‹¤.

---

### π“ μ”μ•½

*   **λ°±μ—”λ“**λ” **WebSocketκ³Ό STOMP**λ¥Ό μ΄μ©ν•΄ μ‹¤μ‹κ°„ λ©”μ‹μ§• μΈν”„λΌλ¥Ό κµ¬μ¶•ν–μΌλ©°, **ν•Έλ“μ…°μ΄ν¬ μΈν„°μ…‰ν„°**λ¥Ό ν†µν•΄ **JWT μΏ ν‚¤**λ΅ WebSocket μ—°κ²°μ„ μ•μ „ν•κ² μΈμ¦ν–μµλ‹λ‹¤.
*   λ°μ΄ν„° μ κ³µ λ°©μ‹μ€ **REST API**λ΅ **κ³Όκ±° λ€ν™” κΈ°λ΅**μ„, **WebSocket**μΌλ΅ **μ‹¤μ‹κ°„ λ©”μ‹μ§€**λ¥Ό μ „λ‹¬ν•λ” ν¨μ¨μ μΈ **ν•μ΄λΈλ¦¬λ“ λ¨λΈ**μ„ μ±„νƒν–μµλ‹λ‹¤.
*   **ν”„λ΅ νΈμ—”λ“**λ” WebSocket κ΄€λ ¨ λ΅μ§μ„ **λ³„λ„μ μ„λΉ„μ¤λ΅ μ¶”μƒν™”**ν•μ—¬ κ΄€λ¦¬ν•κ³ , μ»΄ν¬λ„νΈλ” μ΄ μ„λΉ„μ¤λ¥Ό ν™μ©ν•μ—¬ **μ΄κΈ° λ°μ΄ν„° λ΅λ”©**κ³Ό **μ‹¤μ‹κ°„ μ—…λ°μ΄νΈ**λ¥Ό μμ—°μ¤λ½κ² κ²°ν•©ν•λ” λ°©μ‹μΌλ΅ μ‚¬μ©μ κ²½ν—μ„ κµ¬ν„ν–μµλ‹λ‹¤.