## 0923 Spring Data JPA & QueryDSL λ³µμµ: ν¨μ¨μ μΈ λ°μ΄ν„° μ ‘κ·Ό

---

### β… 1. Spring Data JPA: JPA μ¶”μƒν™”μ™€ μƒμ‚°μ„± ν–¥μƒ

*   **Spring Data JPA**λ” JPA(Java Persistence API)λ¥Ό λ” μ‰½κ³  ν¨μ¨μ μΌλ΅ μ‚¬μ©ν•  μ μλ„λ΅ λ„μ™€μ£Όλ” Spring ν”„λ μ„μ›ν¬μ λ¨λ“μ…λ‹λ‹¤. λ³µμ΅ν• λ°μ΄ν„° μ ‘κ·Ό κ³„μΈµ(DAO) κµ¬ν„μ„ μλ™ν™”ν•μ—¬ κ°λ° μƒμ‚°μ„±μ„ νκΈ°μ μΌλ΅ λ†’μ—¬μ¤λ‹λ‹¤.

#### β• μ£Όμ” κ°λ… λ° νΉμ§•

1.  **Repository μΈν„°νμ΄μ¤**:
    *   `JpaRepository<Entity, ID>` μΈν„°νμ΄μ¤λ¥Ό μƒμ†λ°›λ” κ²ƒλ§μΌλ΅ κΈ°λ³Έμ μΈ CRUD(μƒμ„±, μ΅°ν, μμ •, μ‚­μ ) λ©”μ„λ“(e.g., `save()`, `findById()`, `findAll()`, `delete()`)λ¥Ό μλ™μΌλ΅ μ κ³µλ°›μµλ‹λ‹¤.
    *   κ°λ°μλ” μ§μ ‘ DAO κµ¬ν„μ²΄λ¥Ό μ‘μ„±ν•  ν•„μ” μ—†μ΄ μΈν„°νμ΄μ¤λ§ μ •μν•λ©΄ λ©λ‹λ‹¤.

2.  **μΏΌλ¦¬ λ©”μ„λ“ (Derived Query Methods)**:
    *   λ©”μ„λ“ μ΄λ¦„μ„ νΉμ • κ·μΉ™μ— λ”°λΌ μ‘μ„±ν•λ©΄, Spring Data JPAκ°€ ν•΄λ‹Ή μ΄λ¦„μ— λ§λ” JPQL(Java Persistence Query Language) μΏΌλ¦¬λ¥Ό μλ™μΌλ΅ μƒμ„±ν•μ—¬ μ‹¤ν–‰ν•©λ‹λ‹¤.
    *   **μμ‹**: `findByUsernameAndEmail(String username, String email)`
    *   **μ¥μ **: κ°„λ‹¨ν• μΏΌλ¦¬λ” SQL μ—†μ΄ λ©”μ„λ“ μ΄λ¦„λ§μΌλ΅ μ²λ¦¬ κ°€λ¥ν•μ—¬ κ°λ° μ†λ„κ°€ λΉ λ¦…λ‹λ‹¤.

3.  **`@Query` μ–΄λ…Έν…μ΄μ…**:
    *   μΏΌλ¦¬ λ©”μ„λ“λ§μΌλ΅λ” ν‘ν„ν•κΈ° μ–΄λ ¤μ΄ λ³µμ΅ν• JPQL μΏΌλ¦¬λ‚ λ„¤μ΄ν‹°λΈ SQL μΏΌλ¦¬λ¥Ό μ§μ ‘ μ‘μ„±ν•  μ μλ„λ΅ μ§€μ›ν•©λ‹λ‹¤.
    *   `value` μ†μ„±μ— JPQLμ„, `nativeQuery = true` μ„¤μ • μ‹ SQLμ„ μ‘μ„±ν•©λ‹λ‹¤.

4.  **νμ΄μ§• λ° μ •λ ¬**:
    *   `PagingAndSortingRepository`λ¥Ό μƒμ†λ°›κ±°λ‚ `JpaRepository`μ λ©”μ„λ“μ— `Pageable` κ°μ²΄λ¥Ό μΈμλ΅ μ „λ‹¬ν•μ—¬, μ†μ‰½κ² νμ΄μ§•(Pagination) λ° μ •λ ¬(Sorting) κΈ°λ¥μ„ κµ¬ν„ν•  μ μμµλ‹λ‹¤.

---

### β… 2. QueryDSL: νƒ€μ…-μ„Έμ΄ν”„ν• λ™μ  μΏΌλ¦¬

*   **QueryDSL**μ€ JPQLμ„ **Java μ½”λ“λ΅ μ‘μ„±**ν•  μ μκ² ν•΄μ£Όλ” ν”„λ μ„μ›ν¬μ…λ‹λ‹¤. λ¬Έμμ—΄ κΈ°λ°μ JPQL/SQL μΏΌλ¦¬κ°€ μ•„λ‹, **νƒ€μ…-μ„Έμ΄ν”„(Type-safe)**ν• μ½”λ“λ¥Ό ν†µν•΄ μΏΌλ¦¬λ¥Ό κµ¬μ„±ν•μ—¬ μ—¬λ¬ μ¥μ μ„ μ κ³µν•©λ‹λ‹¤.

#### β• μ£Όμ” κ°λ… λ° νΉμ§•

1.  **Q-Type (Query Type)**:
    *   QueryDSLμ€ μ—”ν‹°ν‹° ν΄λμ¤λ¥Ό κΈ°λ°μΌλ΅ **`Q` μ ‘λ‘μ‚¬κ°€ λ¶™μ€ μ •μ  ν΄λμ¤(Q-Type)**λ¥Ό μλ™μΌλ΅ μƒμ„±ν•©λ‹λ‹¤ (e.g., `User` μ—”ν‹°ν‹° β†’ `QUser`).
    *   μ΄ Q-Typeμ„ ν†µν•΄ μ—”ν‹°ν‹°μ ν•„λ“μ— μ§μ ‘ μ ‘κ·Όν•μ—¬ μΏΌλ¦¬ μ΅°κ±΄μ„ μ‘μ„±ν•  μ μμµλ‹λ‹¤. (e.g., `QUser.user.username.eq("test")`)

2.  **`JPAQueryFactory`**:
    *   QueryDSL μΏΌλ¦¬λ¥Ό μƒμ„±ν•κ³  μ‹¤ν–‰ν•λ” μ§„μ…μ (Entry Point) κ°μ²΄μ…λ‹λ‹¤. Spring ν™κ²½μ—μ„λ” `JPAQueryFactory`λ¥Ό Spring BeanμΌλ΅ λ“±λ΅ν•μ—¬ μ£Όμ…λ°›μ•„ μ‚¬μ©ν•©λ‹λ‹¤.

3.  **λ™μ  μΏΌλ¦¬ (`BooleanBuilder`)**:
    *   κ²€μƒ‰ μ΅°κ±΄μ΄ λ™μ μΌλ΅ λ³€ν•λ” κ²½μ°(e.g., μ‚¬μ©μκ°€ μ…λ ¥ν• κ°’μ— λ”°λΌ `WHERE` μ μ΄ λ‹¬λΌμ§€λ” κ²½μ°)μ— λ§¤μ° μ μ©ν•©λ‹λ‹¤.
    *   `BooleanBuilder` κ°μ²΄μ— `if` λ¬Έ λ“±μ„ μ‚¬μ©ν•μ—¬ μ΅°κ±΄μ΄ λ§μ΅±ν•  λ•λ§ `and()`, `or()` λ©”μ„λ“λ΅ μΏΌλ¦¬ μ΅°κ±΄μ„ μ¶”κ°€ν•©λ‹λ‹¤.
    ```java
    BooleanBuilder builder = new BooleanBuilder();
    if (username != null) builder.and(qUser.username.eq(username));
    if (email != null) builder.and(qUser.email.eq(email));
    // factory.selectFrom(qUser).where(builder).fetch();
    ```

4.  **μ„λΈμΏΌλ¦¬ (`JPAExpressions`)**:
    *   `JPAExpressions` μ ν‹Έλ¦¬ν‹° ν΄λμ¤λ¥Ό μ‚¬μ©ν•μ—¬ `SELECT`, `WHERE`, `HAVING` μ  λ“±μ—μ„ μ„λΈμΏΌλ¦¬λ¥Ό μ‘μ„±ν•  μ μμµλ‹λ‹¤.
    ```java
    // νΉμ • κ·Έλ£Ήμ ν‰κ·  λ‚μ΄λ³΄λ‹¤ λ§μ€ μ‚¬μ©μ μ΅°ν
    // JPAExpressions.select(qUser.age.avg()).from(qUser).where(qUser.group.name.eq("A"))
    ```

5.  **λ™μ  μ •λ ¬ (`OrderSpecifier`)**:
    *   μ‚¬μ©μμ μ”μ²­μ— λ”°λΌ μ •λ ¬ κΈ°μ¤€(μ»¬λΌ)κ³Ό λ°©ν–¥(μ¤λ¦„μ°¨μ/λ‚΄λ¦Όμ°¨μ)μ΄ λ‹¬λΌμ§€λ” κ²½μ°μ— `OrderSpecifier`λ¥Ό μ‚¬μ©ν•μ—¬ λ™μ μΌλ΅ μ •λ ¬ μ΅°κ±΄μ„ κµ¬μ„±ν•  μ μμµλ‹λ‹¤.

---

### β… 3. Spring Data JPAμ™€ QueryDSLμ ν†µν•© (Custom Repository)

*   Spring Data JPAλ” κ°„λ‹¨ν• μΏΌλ¦¬μ— κ°•μ μ„ λ³΄μ΄κ³ , QueryDSLμ€ λ³µμ΅ν•κ³  λ™μ μΈ μΏΌλ¦¬μ— κ°•μ μ„ λ³΄μ…λ‹λ‹¤. μ΄ λ‘μ„ ν•¨κ» μ‚¬μ©ν•μ—¬ ν¨μ¨μ μΈ λ°μ΄ν„° μ ‘κ·Ό κ³„μΈµμ„ κµ¬μ¶•ν•λ” κ²ƒμ΄ μΌλ°μ μ…λ‹λ‹¤.

#### β• ν†µν•© ν¨ν„΄: Custom Repository

1.  **Custom Repository μΈν„°νμ΄μ¤ μ •μ**: QueryDSLλ΅ κµ¬ν„ν•  λ©”μ„λ“λ¥Ό μ„ μ–Έν•λ” μΈν„°νμ΄μ¤λ¥Ό λ§λ“­λ‹λ‹¤ (e.g., `UserRepositoryCustom`).
2.  **Custom Repository κµ¬ν„μ²΄ μ‘μ„±**: μ„ μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν•λ” ν΄λμ¤λ¥Ό λ§λ“¤κ³ , `JPAQueryFactory`λ¥Ό μ£Όμ…λ°›μ•„ QueryDSL μΏΌλ¦¬ λ΅μ§μ„ μ‘μ„±ν•©λ‹λ‹¤ (e.g., `UserRepositoryImpl`).
    *   **κ·μΉ™**: κµ¬ν„μ²΄ ν΄λμ¤ μ΄λ¦„μ€ `[Repository μΈν„°νμ΄μ¤ μ΄λ¦„] + Impl` ν•νƒλ΅ μ§€μ–΄μ•Ό Spring Data JPAκ°€ μλ™μΌλ΅ μ—°κ²°ν•©λ‹λ‹¤.
3.  **κΈ°μ΅΄ Repository μΈν„°νμ΄μ¤ ν™•μ¥**: `JpaRepository`λ¥Ό μƒμ†λ°›λ” κΈ°μ΅΄ Repository μΈν„°νμ΄μ¤κ°€ Custom Repository μΈν„°νμ΄μ¤λ¥Ό ν•¨κ» μƒμ†λ°›λ„λ΅ ν•©λ‹λ‹¤ (e.g., `interface UserRepository extends JpaRepository<User, Long>, UserRepositoryCustom {}`).

*   μ΄λ¬ν• κµ¬μ΅°λ¥Ό ν†µν•΄, `UserRepository`λ” Spring Data JPAμ κΈ°λ³Έ CRUDμ™€ μΏΌλ¦¬ λ©”μ„λ“λ¥Ό μ κ³µν•λ©΄μ„, λ™μ‹μ— QueryDSLλ΅ κµ¬ν„λ λ³µμ΅ν• λ™μ  μΏΌλ¦¬ λ©”μ„λ“κΉμ§€ μ‚¬μ©ν•  μ μκ² λ©λ‹λ‹¤.

---

### π“ μ”μ•½

*   **Spring Data JPA**λ” `JpaRepository`μ™€ μΏΌλ¦¬ λ©”μ„λ“λ¥Ό ν†µν•΄ **λ³΄μΌλ¬ν”λ μ΄νΈ μ½”λ“λ¥Ό μ¤„μ—¬** κ°λ° μƒμ‚°μ„±μ„ λ†’μ…λ‹λ‹¤.
*   **QueryDSL**μ€ **Q-Type**κ³Ό **`JPAQueryFactory`**λ¥Ό μ‚¬μ©ν•μ—¬ **νƒ€μ…-μ„Έμ΄ν”„ν• Java μ½”λ“λ΅ λ™μ  μΏΌλ¦¬**λ¥Ό μ‘μ„±ν•  μ μκ² ν•μ—¬, μ»΄νμΌ μ‹μ  μ¤λ¥ κ°μ§€μ™€ λ†’μ€ κ°€λ…μ„±μ„ μ κ³µν•©λ‹λ‹¤.
*   μ΄ λ‘μ€ **Custom Repository ν¨ν„΄**μ„ ν†µν•΄ ν¨κ³Όμ μΌλ΅ ν†µν•©λμ–΄, κ°„λ‹¨ν• μΏΌλ¦¬λ” Spring Data JPAλ΅, λ³µμ΅ν•κ³  λ™μ μΈ μΏΌλ¦¬λ” QueryDSLλ΅ μ²λ¦¬ν•λ” **μ μ—°ν•κ³  κ°•λ ¥ν• λ°μ΄ν„° μ ‘κ·Ό κ³„μΈµ**μ„ κµ¬μ¶•ν•  μ μμµλ‹λ‹¤.