## 0206 μ¤ν”„λ§ λ¶€νΈ ν”„λ΅μ νΈ (8/N): Nginxλ¥Ό μ΄μ©ν• λ¦¬λ²„μ¤ ν”„λ΅μ‹ κµ¬μ¶•

---

### β… 1. λ¦¬λ²„μ¤ ν”„λ΅μ‹ (Reverse Proxy)λ€?

*   **λ¦¬λ²„μ¤ ν”„λ΅μ‹**λ” ν΄λΌμ΄μ–ΈνΈμ μ”μ²­μ„ **λ€μ‹  λ°›μ•„μ„** λ‚΄λ¶€λ§μ— μλ” μ‹¤μ  μ„λ²„(WAS)λ΅ μ „λ‹¬ν•κ³ , κ·Έ μ‘λ‹µμ„ λ‹¤μ‹ ν΄λΌμ΄μ–ΈνΈμ—κ² μ „λ‹¬ν•λ” **μ¤‘κ° μ„λ²„**μ…λ‹λ‹¤.
*   ν΄λΌμ΄μ–ΈνΈλ” μμ‹ μ΄ μ‹¤μ  WASκ°€ μ•„λ‹ λ¦¬λ²„μ¤ ν”„λ΅μ‹ μ„λ²„μ™€ ν†µμ‹ ν•κ³  μμμ„ μ•μ§€ λ»ν•©λ‹λ‹¤.

*   **μ™ ν•„μ”ν•κ°€?**:
    *   **λ³΄μ•**: μ‹¤μ  μ• ν”λ¦¬μΌ€μ΄μ… μ„λ²„(WAS)μ IP μ£Όμ†λ‚ ν¬νΈλ¥Ό μ™Έλ¶€μ— μ§μ ‘ λ…Έμ¶ν•μ§€ μ•μ•„ λ³΄μ•μ„ κ°•ν™”ν•  μ μμµλ‹λ‹¤.
    *   **λ΅λ“ λ°Έλ°μ‹±**: μ—¬λ¬ λ€μ WASλ΅ μ”μ²­μ„ λ¶„μ‚°μ‹μΌ, λ‹¨μΌ μ„λ²„μ κ³Όλ¶€ν•λ¥Ό λ°©μ§€ν•κ³  κ°€μ©μ„±μ„ λ†’μΌ μ μμµλ‹λ‹¤.
    *   **SSL Offloading**: HTTPS ν†µμ‹ μ— ν•„μ”ν• λ³µμ΅ν• μ•”νΈν™”/λ³µνΈν™” μ‘μ—…μ„ λ¦¬λ²„μ¤ ν”„λ΅μ‹(Nginx)κ°€ μ „λ‹΄ν•κ³ , λ‚΄λ¶€ WASμ™€λ” κ°€λ²Όμ΄ HTTPλ΅ ν†µμ‹ ν•μ—¬ WASμ λ¶€λ‹΄μ„ μ¤„μ—¬μ¤λ‹λ‹¤.
    *   **λ¬΄μ¤‘λ‹¨ λ°°ν¬**: λ°°ν¬ μ‹ νΈλν”½μ„ κµ¬λ²„μ „μ—μ„ μ‹ λ²„μ „μΌλ΅ μ μ§„μ μΌλ΅ μ „ν™ν•λ” λ“±μ μ „λµμ„ κµ¬ν„ν•  μ μμµλ‹λ‹¤.

*   **Nginx**: λ›°μ–΄λ‚ μ„±λ¥κ³Ό λ‚®μ€ λ©”λ¨λ¦¬ μ‚¬μ©λ‰ λ•λ¶„μ— λ¦¬λ²„μ¤ ν”„λ΅μ‹ μ„λ²„λ΅ λ§¤μ° λ„λ¦¬ μ‚¬μ©λ©λ‹λ‹¤.

---

### β… 2. Nginx μ„¤μΉ λ° κΈ°λ³Έ μ„¤μ •

*   AWS EC2μ™€ κ°™μ€ λ¦¬λ…μ¤ μ„λ²„ ν™κ²½μ—μ„ Nginxλ¥Ό μ„¤μΉν•κ³  μ„¤μ •ν•λ” κ³Όμ •μ…λ‹λ‹¤.

1.  **Nginx μ„¤μΉ** (Amazon Linux/CentOS κΈ°μ¤€):
    ```bash
    sudo yum install -y nginx
    ```

2.  **Nginx μ„λΉ„μ¤ μ‹μ‘ λ° ν™μ„±ν™”**:
    ```bash
    sudo systemctl start nginx
    sudo systemctl enable nginx
    ```

3.  **λ°©ν™”λ²½ μ„¤μ •**: μ™Έλ¶€μ—μ„ HTTP(80) λ° HTTPS(443) ν¬νΈλ΅ μ ‘κ·Όν•  μ μλ„λ΅ λ°©ν™”λ²½(AWS λ³΄μ• κ·Έλ£Ή λ“±)μ„ μ—΄μ–΄μ£Όμ–΄μ•Ό ν•©λ‹λ‹¤.

---

### β… 3. Nginx λ¦¬λ²„μ¤ ν”„λ΅μ‹ μ„¤μ •ν•κΈ°

*   Nginxμ μ„¤μ • νμΌμ„ μμ •ν•μ—¬, νΉμ • λ„λ©”μΈμΌλ΅ λ“¤μ–΄μ¨ μ”μ²­μ„ λ‚΄λ¶€μ—μ„ μ‹¤ν–‰ μ¤‘μΈ Spring Boot μ• ν”λ¦¬μΌ€μ΄μ…μΌλ΅ μ „λ‹¬ν•λ„λ΅ κµ¬μ„±ν•©λ‹λ‹¤.

*   **μ„¤μ • νμΌ μ„μΉ**: `/etc/nginx/nginx.conf` λλ” `/etc/nginx/conf.d/default.conf`

#### β• κΈ°λ³Έ λ¦¬λ²„μ¤ ν”„λ΅μ‹ μ„¤μ • μμ‹

```nginx
# /etc/nginx/conf.d/my-app.conf

server {
    # 1. μ™Έλ¶€μ—μ„ μ”μ²­μ„ λ°›μ„ ν¬νΈ
    listen 80;
    # 2. μ΄ μ„¤μ •μ΄ μ μ©λ  λ„λ©”μΈ μ΄λ¦„
    server_name my-app.com;

    # 3. '/' κ²½λ΅λ΅ λ“¤μ–΄μ¤λ” λ¨λ“  μ”μ²­μ„ μ²λ¦¬
    location / {
        # 4. μ”μ²­μ„ http://127.0.0.1:8080 (λ΅μ»¬μ—μ„ μ‹¤ν–‰ μ¤‘μΈ Spring Boot WAS)λ΅ μ „λ‹¬
        proxy_pass http://127.0.0.1:8080;

        # 5. WASμ— ν΄λΌμ΄μ–ΈνΈμ μ‹¤μ  μ •λ³΄λ¥Ό μ „λ‹¬ν•κΈ° μ„ν• ν—¤λ” μ„¤μ • (λ§¤μ° μ¤‘μ”)
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

1.  **`listen 80`**: 80λ² ν¬νΈ(HTTP)λ΅ λ“¤μ–΄μ¤λ” μ”μ²­μ„ λ°›μµλ‹λ‹¤.
2.  **`server_name`**: `my-app.com` λ„λ©”μΈμΌλ΅ λ“¤μ–΄μ¨ μ”μ²­μ— λ€ν•΄μ„λ§ μ΄ μ„¤μ •μ„ μ μ©ν•©λ‹λ‹¤.
3.  **`location /`**: ν•΄λ‹Ή λ„λ©”μΈμ λ¨λ“  κ²½λ΅(`/`)μ— λ€ν• μ”μ²­μ„ μ²λ¦¬ν•©λ‹λ‹¤.
4.  **`proxy_pass`**: μ΄ μ„¤μ •μ **ν•µμ‹¬**. μ”μ²­μ„ μ§€μ •λ μ£Όμ†λ΅ μ „λ‹¬ν•©λ‹λ‹¤. `127.0.0.1:8080`μ€ ν„μ¬ μ„λ²„μ—μ„ 8080 ν¬νΈλ΅ μ‹¤ν–‰ μ¤‘μΈ Spring Boot μ• ν”λ¦¬μΌ€μ΄μ…μ„ μλ―Έν•©λ‹λ‹¤.
5.  **`proxy_set_header`**: WASκ°€ λ¦¬λ²„μ¤ ν”„λ΅μ‹ λ’¤μ— μλ‹¤λ” μ‚¬μ‹¤μ„ μΈμ§€ν•κ³ , ν΄λΌμ΄μ–ΈνΈμ μ‹¤μ  IP μ£Όμ†, μ”μ²­ ν”„λ΅ν† μ½(http/https) λ“±μ„ μ¬λ°”λ¥΄κ² μ²λ¦¬ν•  μ μλ„λ΅ κ΄€λ ¨ μ •λ³΄λ¥Ό HTTP ν—¤λ”μ— λ‹΄μ•„ μ „λ‹¬ν•λ” μ¤‘μ”ν• μ„¤μ •μ…λ‹λ‹¤.

#### β• μ„¤μ • μ μ©

*   μ„¤μ • νμΌμ„ μμ •ν• ν›„μ—λ” λ¬Έλ²•μ— μ¤λ¥κ°€ μ—†λ”μ§€ ν™•μΈν•κ³ , Nginx μ„λΉ„μ¤λ¥Ό μ¬μ‹μ‘ν•μ—¬ λ³€κ²½ μ‚¬ν•­μ„ μ μ©ν•΄μ•Ό ν•©λ‹λ‹¤.
    ```bash
    # μ„¤μ • νμΌ λ¬Έλ²• κ²€μ‚¬
    sudo nginx -t

    # Nginx μ¬μ‹μ‘
    sudo systemctl restart nginx
    ```

---

### β… 4. λ¬΄μ¤‘λ‹¨ λ°°ν¬λ¥Ό μ„ν• λ¦¬λ²„μ¤ ν”„λ΅μ‹ ν™μ©

*   Nginx λ¦¬λ²„μ¤ ν”„λ΅μ‹λ¥Ό μ‚¬μ©ν•λ©΄ κ°„λ‹¨ν• ν•νƒμ λ¬΄μ¤‘λ‹¨ λ°°ν¬(Blue-Greenκ³Ό μ μ‚¬)λ¥Ό κµ¬ν„ν•  μ μμµλ‹λ‹¤.

#### β• λ¬΄μ¤‘λ‹¨ λ°°ν¬ μ¤ν¬λ¦½νΈ νλ¦„

1.  **μ‹ κ· λ²„μ „ μ‹¤ν–‰**: μƒλ΅μ΄ λ²„μ „μ Spring Boot μ• ν”λ¦¬μΌ€μ΄μ…μ„ **λ‹¤λ¥Έ ν¬νΈ**(e.g., 8081)λ΅ μ‹¤ν–‰ν•©λ‹λ‹¤. (ν„μ¬ κµ¬λ²„μ „μ€ 8080 ν¬νΈμ—μ„ κ³„μ† μ‹¤ν–‰ μ¤‘)
2.  **ν—¬μ¤ μ²΄ν¬**: 8081 ν¬νΈλ΅ μ‹¤ν–‰λ μ‹ κ· λ²„μ „μ΄ μ •μƒμ μΌλ΅ κµ¬λ™λμ—λ”μ§€ ν™•μΈν•©λ‹λ‹¤.
3.  **νΈλν”½ μ „ν™**: μ‹ κ· λ²„μ „μ΄ μ •μƒμ΄λ©΄, **Nginx μ„¤μ • νμΌ(`my-app.conf`)μ `proxy_pass` μ£Όμ†λ¥Ό `127.0.0.1:8081`λ΅ λ™μ μΌλ΅ λ³€κ²½**ν•©λ‹λ‹¤.
4.  **Nginx λ¦¬λ΅λ“**: `sudo systemctl reload nginx` λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•μ—¬, μ„λΉ„μ¤λ¥Ό μ¤‘λ‹¨ν•μ§€ μ•κ³  λ³€κ²½λ μ„¤μ •λ§ λ‹¤μ‹ λ¶λ¬μµλ‹λ‹¤. μ΄ μκ°„λ¶€ν„° λ¨λ“  μƒλ΅μ΄ μ”μ²­μ€ μ‹ κ· λ²„μ „(8081)μΌλ΅ μ „λ‹¬λ©λ‹λ‹¤.
5.  **κµ¬λ²„μ „ μΆ…λ£**: κµ¬λ²„μ „(8080)μ—μ„ μ²λ¦¬ μ¤‘μ΄λ κΈ°μ΅΄ μ”μ²­λ“¤μ΄ λ¨λ‘ μ™„λ£λ  λ•κΉμ§€ μ μ‹ κΈ°λ‹¤λ¦° ν›„, κµ¬λ²„μ „ ν”„λ΅μ„Έμ¤λ¥Ό μΆ…λ£ν•©λ‹λ‹¤.

*   μ΄λ¬ν• νλ¦„μ„ μ…Έ μ¤ν¬λ¦½νΈλ΅ μλ™ν™”ν•μ—¬ CI/CD νμ΄ν”„λΌμΈμ— ν†µν•©ν•λ©΄, λ°°ν¬ κ³Όμ •μ—μ„ μ‚¬μ©μκ°€ μ„λΉ„μ¤ μ¤‘λ‹¨μ„ μ „ν€ λλΌμ§€ μ•κ² ν•  μ μμµλ‹λ‹¤.

---

### π“ μ”μ•½

*   **λ¦¬λ²„μ¤ ν”„λ΅μ‹**λ” μ™Έλ¶€ ν΄λΌμ΄μ–ΈνΈ μ”μ²­μ„ λ°›μ•„ λ‚΄λ¶€ WASλ΅ μ „λ‹¬ν•λ” μ¤‘κ° μ„λ²„λ΅, **λ³΄μ•, λ΅λ“ λ°Έλ°μ‹±, SSL μ²λ¦¬** λ“± λ‹¤μ–‘ν• μ΄μ μ„ μ κ³µν•©λ‹λ‹¤.
*   **Nginx**λ” λ›°μ–΄λ‚ μ„±λ¥μΌλ΅ λ¦¬λ²„μ¤ ν”„λ΅μ‹ μ„λ²„λ΅ λ„λ¦¬ μ‚¬μ©λλ©°, `proxy_pass` μ§€μ‹μ–΄λ¥Ό ν†µν•΄ κ°„λ‹¨ν•κ² μ„¤μ •ν•  μ μμµλ‹λ‹¤.
*   `proxy_set_header` μ„¤μ •μ€ WASκ°€ ν΄λΌμ΄μ–ΈνΈμ μ‹¤μ  μ •λ³΄λ¥Ό μ¬λ°”λ¥΄κ² μΈμ‹ν•λ„λ΅ λ•λ” μ¤‘μ”ν• λ¶€λ¶„μ…λ‹λ‹¤.
*   Nginx λ¦¬λ²„μ¤ ν”„λ΅μ‹μ **νΈλν”½ μ „ν™** κΈ°λ¥μ„ ν™μ©ν•λ©΄, μ„λΉ„μ¤ μ¤‘λ‹¨ μ—†μ΄ μ• ν”λ¦¬μΌ€μ΄μ…μ„ μ—…λ°μ΄νΈν•λ” **λ¬΄μ¤‘λ‹¨ λ°°ν¬**λ¥Ό κµ¬ν„ν•  μ μμµλ‹λ‹¤.