## 0202 ìŠ¤í”„ë§ ë¶€íŠ¸ í”„ë¡œì íŠ¸ (4/N): ìœ íš¨ì„± ê²€ì¦ê³¼ ì „ì—­ ì˜ˆì™¸ ì²˜ë¦¬

---

### âœ… 1. ë°ì´í„° ìœ íš¨ì„± ê²€ì¦ (Bean Validation)

*   í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ë°›ì€ ë°ì´í„°(DTO)ê°€ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì— ë§ëŠ”ì§€ ê²€ì¦í•˜ëŠ” ê²ƒì€ ì‹œìŠ¤í…œì˜ ì•ˆì •ì„±ê³¼ ë°ì´í„° ë¬´ê²°ì„±ì„ ìœ„í•´ í•„ìˆ˜ì ì…ë‹ˆë‹¤. Spring BootëŠ” `Bean Validation` í‘œì¤€ì„ í†µí•´ ì´ë¥¼ ì„ ì–¸ì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ ë•ìŠµë‹ˆë‹¤.

#### â• ì˜ì¡´ì„± ì¶”ê°€ (`build.gradle`)
```gradle
dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-validation'
}
```

#### â• ì£¼ìš” ê²€ì¦ ì–´ë…¸í…Œì´ì…˜
| ì–´ë…¸í…Œì´ì…˜ | ì„¤ëª… |
| :--- | :--- |
| **`@NotBlank`** | nullì´ ì•„ë‹ˆê³ , ìµœì†Œí•œ í•˜ë‚˜ì˜ ë¹„ê³µë°± ë¬¸ìë¥¼ í¬í•¨í•´ì•¼ í•¨. (ë¬¸ìì—´ ì „ìš©) |
| **`@NotNull`** | nullì´ ì•„ë‹ˆì–´ì•¼ í•¨. |
| **`@Size(min=, max=)`** | ë¬¸ìì—´, ë°°ì—´ ë“±ì˜ í¬ê¸°ê°€ ì§€ì •ëœ ë²”ìœ„ ë‚´ì— ìˆì–´ì•¼ í•¨. |
| **`@Email`** | ìœ íš¨í•œ ì´ë©”ì¼ í˜•ì‹ì´ì–´ì•¼ í•¨. |
| **`@Min` / `@Max`** | ì§€ì •ëœ ìˆ«ì ê°’ ì´ìƒ/ì´í•˜ì´ì–´ì•¼ í•¨. |

#### â• DTO ë° ì»¨íŠ¸ë¡¤ëŸ¬ ì ìš©
```java
// PostCreateRequest.java
@Getter
@NoArgsConstructor
public class PostCreateRequest {
    @NotBlank(message = "ì œëª©ì€ í•„ìˆ˜ ì…ë ¥ ê°’ì…ë‹ˆë‹¤.")
    @Size(max = 100, message = "ì œëª©ì€ 100ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.")
    private String title;

    @NotBlank(message = "ë‚´ìš©ì€ í•„ìˆ˜ ì…ë ¥ ê°’ì…ë‹ˆë‹¤.")
    private String content;
}

// PostController.java
@PostMapping
public ResponseEntity<ApiResponse<Long>> createPost(@Valid @RequestBody PostCreateRequest request) {
    // @Valid: DTOì˜ ê²€ì¦ ì–´ë…¸í…Œì´ì…˜ì„ ê¸°ë°˜ìœ¼ë¡œ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìˆ˜í–‰
    Long postId = postService.createPost(request);
    return ResponseEntity.ok(ApiResponse.success(postId));
}
```

---

### âœ… 2. ì „ì—­ ì˜ˆì™¸ ì²˜ë¦¬ (Global Exception Handling)

*   ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì—­ì—ì„œ ë°œìƒí•˜ëŠ” ì˜ˆì™¸ë¥¼ í•œ ê³³ì—ì„œ ì¤‘ì•™ ì§‘ì¤‘ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ì—¬, ì‚¬ìš©ìì—ê²Œ ì¼ê´€ëœ ì—ëŸ¬ ì‘ë‹µì„ ì œê³µí•˜ê³  ì½”ë“œ ì¤‘ë³µì„ ì œê±°í•©ë‹ˆë‹¤.

#### â• `@RestControllerAdvice`
*   **ê°œë…**: ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë°œìƒí•˜ëŠ” ì˜ˆì™¸ë¥¼ ê°€ë¡œì±„ì„œ ì²˜ë¦¬í•˜ëŠ” í´ë˜ìŠ¤ë¥¼ ì„ ì–¸í•©ë‹ˆë‹¤.
*   **`@ExceptionHandler`**: íŠ¹ì • ì˜ˆì™¸ íƒ€ì…ì„ ì§€ì •í•˜ì—¬ í•´ë‹¹ ì˜ˆì™¸ê°€ ë°œìƒí–ˆì„ ë•Œ ì‹¤í–‰ë  ë©”ì„œë“œë¥¼ ì •ì˜í•©ë‹ˆë‹¤.

#### â• ì»¤ìŠ¤í…€ ì˜ˆì™¸ í´ë˜ìŠ¤ ì„¤ê³„
*   ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ìƒì˜ ì˜¤ë¥˜ë¥¼ ëª…í™•íˆ í‘œí˜„í•˜ê¸° ìœ„í•´ `RuntimeException`ì„ ìƒì†ë°›ì€ ì»¤ìŠ¤í…€ ì˜ˆì™¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

```java
// BusinessException.java
@Getter
public class BusinessException extends RuntimeException {
    private final ErrorCode errorCode;

    public BusinessException(ErrorCode errorCode) {
        super(errorCode.getMessage());
        this.errorCode = errorCode;
    }
}
```

---

### âœ… 3. ì¼ê´€ëœ API ì‘ë‹µ í˜•ì‹ ì„¤ê³„

*   ì„±ê³µê³¼ ì‹¤íŒ¨ ì‘ë‹µì˜ êµ¬ì¡°ë¥¼ í†µì¼í•˜ì—¬ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œìê°€ ì˜ˆì¸¡ ê°€ëŠ¥í•œ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.

#### â• ê³µí†µ ì‘ë‹µ ê°ì²´ (`ApiResponse`)
```java
@Getter
@AllArgsConstructor
public class ApiResponse<T> {
    private boolean success;
    private String message;
    private T data;

    public static <T> ApiResponse<T> success(T data) {
        return new ApiResponse<>(true, "ìš”ì²­ ì„±ê³µ", data);
    }

    public static ApiResponse<Void> error(String message) {
        return new ApiResponse<>(false, message, null);
    }
}
```

#### â• ì „ì—­ ì˜ˆì™¸ í•¸ë“¤ëŸ¬ êµ¬í˜„ ì˜ˆì‹œ
```java
@RestControllerAdvice
public class GlobalExceptionHandler {

    // ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸ ì²˜ë¦¬
    @ExceptionHandler(BusinessException.class)
    public ResponseEntity<ApiResponse<Void>> handleBusinessException(BusinessException e) {
        return ResponseEntity
                .status(e.getErrorCode().getStatus())
                .body(ApiResponse.error(e.getMessage()));
    }

    // @Valid ê²€ì¦ ì‹¤íŒ¨ ì˜ˆì™¸ ì²˜ë¦¬
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResponseEntity<ApiResponse<Void>> handleValidationException(MethodArgumentNotValidException e) {
        String errorMessage = e.getBindingResult().getAllErrors().get(0).getDefaultMessage();
        return ResponseEntity.badRequest().body(ApiResponse.error(errorMessage));
    }

    // ê·¸ ì™¸ ì˜ˆìƒì¹˜ ëª»í•œ ëª¨ë“  ì˜ˆì™¸ ì²˜ë¦¬
    @ExceptionHandler(Exception.class)
    public ResponseEntity<ApiResponse<Void>> handleException(Exception e) {
        return ResponseEntity.internalServerError().body(ApiResponse.error("ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."));
    }
}
```

---

### ğŸ“Œ ìš”ì•½

*   **`spring-boot-starter-validation`**ì„ ì‚¬ìš©í•˜ì—¬ DTO ë ˆë²¨ì—ì„œ ë°ì´í„°ì˜ ìœ íš¨ì„±ì„ ì„ ì–¸ì ìœ¼ë¡œ ê²€ì¦í•©ë‹ˆë‹¤.
*   **`@Valid`** ì–´ë…¸í…Œì´ì…˜ì„ ì»¨íŠ¸ë¡¤ëŸ¬ íŒŒë¼ë¯¸í„°ì— ë¶™ì—¬ ê²€ì¦ ë¡œì§ì„ í™œì„±í™”í•©ë‹ˆë‹¤.
*   **`@RestControllerAdvice`**ì™€ **`@ExceptionHandler`**ë¥¼ í†µí•´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì—­ì˜ ì˜ˆì™¸ ì²˜ë¦¬ ë¡œì§ì„ í•œ ê³³ìœ¼ë¡œ ëª¨ì•„ ê´€ë¦¬ íš¨ìœ¨ì„±ì„ ë†’ì…ë‹ˆë‹¤.
*   **`ApiResponse`**ì™€ ê°™ì€ ê³µí†µ ì‘ë‹µ ê°ì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  APIì˜ ì‘ë‹µ í˜•ì‹ì„ í‘œì¤€í™”í•¨ìœ¼ë¡œì¨ í´ë¼ì´ì–¸íŠ¸ì™€ì˜ í†µì‹  ê·œì•½ì„ ëª…í™•íˆ í•©ë‹ˆë‹¤.