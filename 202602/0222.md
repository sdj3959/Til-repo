## 0222 NestJS μ‹¬ν™” (5/N): GraphQLκ³Ό λ°μ΄ν„°λ² μ΄μ¤ μΏΌλ¦¬

---

### β… 1. GraphQLμ΄λ€ λ¬΄μ—‡μΈκ°€? (REST APIμ™€μ μ°¨μ΄μ )

*   **GraphQL**μ€ APIλ¥Ό μ„ν• **μΏΌλ¦¬ μ–Έμ–΄(Query Language)**μ΄μ, ν•΄λ‹Ή μΏΌλ¦¬λ¥Ό μ‹¤ν–‰ν•κΈ° μ„ν• μ„λ²„ μΈ΅ λ°νƒ€μ„μ…λ‹λ‹¤. νμ΄μ¤λ¶(ν„ λ©”νƒ€)μ—μ„ κ°λ°ν–μµλ‹λ‹¤.

*   **REST APIμ λ¬Έμ μ **:
    1.  **Over-fetching**: νΉμ • μ—”λ“ν¬μΈνΈκ°€ ν•­μƒ μ •ν•΄μ§„ κµ¬μ΅°μ λ¨λ“  λ°μ΄ν„°λ¥Ό λ°ν™ν•λ―€λ΅, ν΄λΌμ΄μ–ΈνΈκ°€ ν•„μ”λ΅ ν•λ” κ²ƒλ³΄λ‹¤ **λ” λ§μ€ λ°μ΄ν„°**λ¥Ό λ°›μ•„μ¤λ” λ¬Έμ . (e.g., μ‚¬μ©μ λ©λ΅μ—μ„ μ΄λ¦„λ§ ν•„μ”ν•λ°, μ£Όμ†, λ‚μ΄ λ“± λ¨λ“  μ •λ³΄κ°€ λ”Έλ ¤μ΄)
    2.  **Under-fetching**: μ›ν•λ” λ°μ΄ν„°λ¥Ό μ™„μ„±ν•κΈ° μ„ν•΄ **μ—¬λ¬ λ²μ μ”μ²­**μ„ λ³΄λ‚΄μ•Ό ν•λ” λ¬Έμ . (e.g., κ²μ‹κΈ€ μ •λ³΄λ¥Ό κ°€μ Έμ¨ ν›„, κ° κ²μ‹κΈ€μ μ‘μ„±μ μ •λ³΄λ¥Ό μ–»κΈ° μ„ν•΄ λ‹¤μ‹ μ—¬λ¬ λ² μ”μ²­)

*   **GraphQLμ ν•΄κ²°μ±…**:
    *   **"ν•„μ”ν• κ²ƒλ§ λ¬Όμ–΄λ³΄κ³ , μ •ν™•ν κ·Έκ²ƒλ§ λ°›λ”λ‹¤."**
    *   ν΄λΌμ΄μ–ΈνΈκ°€ **μ›ν•λ” λ°μ΄ν„°μ κµ¬μ΅°λ¥Ό μΏΌλ¦¬λ΅ μ§μ ‘ μ •μ**ν•μ—¬ μ„λ²„μ— λ³΄λ‚΄λ©΄, μ„λ²„λ” μ •ν™•ν κ·Έ κµ¬μ΅°μ— λ§λ” λ°μ΄ν„°λ§ μ‘λ‹µν•©λ‹λ‹¤.
    *   μ΄λ¥Ό ν†µν•΄ μ—¬λ¬ λ²μ μ”μ²­μ„ λ‹¨ **ν• λ²μ μ”μ²­**μΌλ΅ μ²λ¦¬ν•  μ μμµλ‹λ‹¤.

| κµ¬λ¶„ | REST API | GraphQL |
| :--- | :--- | :--- |
| **μ—”λ“ν¬μΈνΈ** | μ—¬λ¬ κ° (e.g., `/users`, `/posts`) | λ‹¨ ν•λ‚ (e.g., `/graphql`) |
| **λ°μ΄ν„° κµ¬μ΅°** | μ„λ²„κ°€ μ •μ (κ³ μ •μ ) | **ν΄λΌμ΄μ–ΈνΈκ°€ μ •μ** (μ μ—°ν•¨) |
| **μ”μ²­ λ°©μ‹** | HTTP λ©”μ„λ“(GET, POST λ“±)λ΅ λ™μ‘ μ •μ | ν•­μƒ POST μ”μ²­, μΏΌλ¦¬ λ‚΄μ©μΌλ΅ λ™μ‘ μ •μ |

---

### β… 2. NestJSμ™€ GraphQL ν†µν•© (`@nestjs/graphql`)

*   NestJSλ” `@nestjs/graphql`κ³Ό `@nestjs/apollo` λ¨λ“μ„ ν†µν•΄ GraphQL μ„λ²„λ¥Ό λ§¤μ° μ‰½κ³  κµ¬μ΅°μ μΌλ΅ κµ¬μ¶•ν•  μ μλ„λ΅ μ§€μ›ν•©λ‹λ‹¤.

#### β• 2-1. μ£Όμ” κ°λ… (Code-First μ ‘κ·Ό λ°©μ‹)

*   **Code-First**: GraphQL μ¤ν‚¤λ§λ¥Ό μ§μ ‘ μ‘μ„±ν•λ” λ€μ‹ , **TypeScript ν΄λμ¤μ™€ λ°μ½”λ μ΄ν„°**λ¥Ό μ‚¬μ©ν•μ—¬ μ½”λ“λ¥Ό μ‘μ„±ν•λ©΄, NestJSκ°€ μ΄λ¥Ό κΈ°λ°μΌλ΅ **μλ™μΌλ΅ GraphQL μ¤ν‚¤λ§λ¥Ό μƒμ„±**ν•λ” λ°©μ‹μ…λ‹λ‹¤.

1.  **`@ObjectType()`**:
    *   GraphQL μ¤ν‚¤λ§μ **νƒ€μ…**μ„ μ •μν•λ” ν΄λμ¤μ— μ‚¬μ©λ©λ‹λ‹¤. (e.g., `Movie` νƒ€μ…)
2.  **`@Field()`**:
    *   ν•΄λ‹Ή νƒ€μ…μ΄ κ°€μ§€λ” **ν•„λ“**λ¥Ό μ •μν•©λ‹λ‹¤. λ°μ΄ν„° νƒ€μ…(e.g., `Int`, `String`)μ„ λ…μ‹ν•  μ μμµλ‹λ‹¤.
3.  **`@Resolver()`**:
    *   νΉμ • νƒ€μ…μ— λ€ν• **μΏΌλ¦¬(λ°μ΄ν„° μ΅°ν)μ™€ λ®¤ν…μ΄μ…(λ°μ΄ν„° λ³€κ²½)**μ„ μ²λ¦¬ν•λ” λ©”μ„λ“λ¥Ό λ‹΄κ³  μλ” ν΄λμ¤μ…λ‹λ‹¤. Springμ `@Controller`μ™€ μ μ‚¬ν• μ—­ν• μ…λ‹λ‹¤.
4.  **`@Query()`**:
    *   λ°μ΄ν„°λ¥Ό **μ΅°ν**ν•λ” λ¦¬μ΅Έλ²„ λ©”μ„λ“μ— μ‚¬μ©λ©λ‹λ‹¤.
5.  **`@Mutation()`**:
    *   λ°μ΄ν„°λ¥Ό **μƒμ„±, μμ •, μ‚­μ **ν•λ” λ¦¬μ΅Έλ²„ λ©”μ„λ“μ— μ‚¬μ©λ©λ‹λ‹¤.
6.  **`@Args()`**:
    *   μΏΌλ¦¬λ‚ λ®¤ν…μ΄μ…μ— μ „λ‹¬λλ” μΈμλ¥Ό λ°›κΈ° μ„ν•΄ μ‚¬μ©λ©λ‹λ‹¤.

#### β• 2-2. GraphQL μ„λ²„ μ„¤μ • λ° μμ‹

```typescript
// movie.dto.ts - GraphQL νƒ€μ…μ„ μ„ν• DTO
import { ObjectType, Field, Int } from '@nestjs/graphql';

@ObjectType()
export class Movie {
  @Field(() => Int)
  id: number;

  @Field()
  title: string;
}

// movies.resolver.ts
import { Resolver, Query, Mutation, Args, Int } from '@nestjs/graphql';
import { Movie } from './dto/movie.dto';

@Resolver(() => Movie) // μ΄ λ¦¬μ΅Έλ²„κ°€ Movie νƒ€μ…μ„ μ²λ¦¬ν•¨μ„ λ…μ‹
export class MoviesResolver {
  constructor(private readonly moviesService: MoviesService) {}

  @Query(() => [Movie]) // 'movies'λΌλ” μΏΌλ¦¬λ¥Ό μ •μν•κ³ , λ°ν™ νƒ€μ…μ€ Movie λ°°μ—΄
  movies(): Promise<Movie[]> {
    return this.moviesService.findAll();
  }

  @Mutation(() => Movie) // 'createMovie'λΌλ” λ®¤ν…μ΄μ…μ„ μ •μ
  createMovie(@Args('title') title: string): Promise<Movie> {
    return this.moviesService.create(title);
  }
}
```

---

### β… 3. GraphQLκ³Ό TypeORM μ—°λ™

*   GraphQL λ¦¬μ΅Έλ²„λ” λΉ„μ¦λ‹μ¤ λ΅μ§μ„ μ„λΉ„μ¤μ— μ„μ„ν•κ³ , μ„λΉ„μ¤λ” TypeORM λ¦¬ν¬μ§€ν† λ¦¬λ¥Ό ν†µν•΄ λ°μ΄ν„°λ² μ΄μ¤μ™€ μƒνΈμ‘μ©ν•©λ‹λ‹¤. μ΄ κµ¬μ΅°λ” REST APIμ™€ λ™μΌν•©λ‹λ‹¤.

*   **λ¦¬μ΅Έλ²„μ μ—­ν• **: ν΄λΌμ΄μ–ΈνΈμ GraphQL μΏΌλ¦¬λ¥Ό ν•΄μ„ν•μ—¬, μ μ ν• μ„λΉ„μ¤ λ©”μ„λ“λ¥Ό νΈμ¶ν•κ³  κ·Έ κ²°κ³Όλ¥Ό λ°ν™ν•λ” **"λ²μ—­κ°€"**μ΄μ **"μ¤‘κ°μ"**μ…λ‹λ‹¤.

```typescript
// movies.service.ts
@Injectable()
export class MoviesService {
  constructor(
    @InjectRepository(MovieEntity) // TypeORM μ—”ν‹°ν‹°μ λ¦¬ν¬μ§€ν† λ¦¬ μ£Όμ…
    private readonly movieRepository: Repository<MovieEntity>,
  ) {}

  async findAll(): Promise<MovieEntity[]> {
    // DBμ—μ„ λ¨λ“  μν™” μ΅°ν
    return this.movieRepository.find();
  }

  async create(title: string): Promise<MovieEntity> {
    const newMovie = this.movieRepository.create({ title });
    // DBμ— μƒ μν™” μ €μ¥
    return this.movieRepository.save(newMovie);
  }
}```

*   **GraphQL Playground**: NestJSλ” κ°λ° ν™κ²½μ—μ„ GraphQL APIλ¥Ό μ‰½κ² ν…μ¤νΈν•κ³  λ¬Έμ„λ¥Ό ν™•μΈν•  μ μλ” **GraphQL Playground**λΌλ” λ„κµ¬λ¥Ό μλ™μΌλ΅ μ κ³µν•©λ‹λ‹¤.

---

### π“ μ”μ•½

*   **GraphQL**μ€ ν΄λΌμ΄μ–ΈνΈκ°€ **ν•„μ”ν• λ°μ΄ν„°μ κµ¬μ΅°λ¥Ό μ§μ ‘ μ •μ**ν•μ—¬ μ”μ²­ν•λ” API μΏΌλ¦¬ μ–Έμ–΄λ΅, **Over-fetchingκ³Ό Under-fetching λ¬Έμ λ¥Ό ν•΄κ²°**ν•©λ‹λ‹¤.
*   NestJSλ” **`@nestjs/graphql`** λ¨λ“κ³Ό **Code-First** μ ‘κ·Ό λ°©μ‹μ„ ν†µν•΄, TypeScript ν΄λμ¤μ™€ λ°μ½”λ μ΄ν„°λ§μΌλ΅ **GraphQL μ¤ν‚¤λ§λ¥Ό μλ™μΌλ΅ μƒμ„±**ν•κ³  μ„λ²„λ¥Ό μ‰½κ² κµ¬μ¶•ν•  μ μμµλ‹λ‹¤.
*   GraphQLμ **λ¦¬μ΅Έλ²„(`@Resolver`)**λ” ν΄λΌμ΄μ–ΈνΈμ μΏΌλ¦¬μ™€ λ®¤ν…μ΄μ…μ„ λ°›μ•„, κΈ°μ΅΄μ— λ§λ“¤μ–΄ λ‘” **μ„λΉ„μ¤(Service)**μ™€ **TypeORM λ¦¬ν¬μ§€ν† λ¦¬(Repository)**λ¥Ό νΈμ¶ν•μ—¬ λΉ„μ¦λ‹μ¤ λ΅μ§μ„ μ²λ¦¬ν•©λ‹λ‹¤.
*   κ²°κ³Όμ μΌλ΅, NestJSμ—μ„λ” λ°μ΄ν„°λ² μ΄μ¤ λ΅μ§μ„ μ¬μ‚¬μ©ν•λ©΄μ„, κΈ°μ΅΄μ REST API μ—”λ“ν¬μΈνΈμ™€ GraphQL μ—”λ“ν¬μΈνΈλ¥Ό **λ™μ‹μ— μ κ³µ**ν•λ” μ μ—°ν• μ•„ν‚¤ν…μ²λ¥Ό μ‰½κ² κµ¬ν„ν•  μ μμµλ‹λ‹¤.