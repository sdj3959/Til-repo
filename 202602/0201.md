## 0201 ìŠ¤í”„ë§ ë¶€íŠ¸ í”„ë¡œì íŠ¸ (3/N): ê³„ì¸µí˜• ì•„í‚¤í…ì²˜ì™€ ì„œë¹„ìŠ¤ ë¡œì§

---

### âœ… 1. ê³„ì¸µí˜• ì•„í‚¤í…ì²˜ (Layered Architecture)

*   Spring ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì¼ë°˜ì ìœ¼ë¡œ **ê³„ì¸µí˜• ì•„í‚¤í…ì²˜**ë¥¼ ë”°ë¦…ë‹ˆë‹¤. ì´ëŠ” ê° ë¶€ë¶„ì´ íŠ¹ì • ì±…ì„ë§Œ ê°–ë„ë¡ ì½”ë“œë¥¼ êµ¬ì„±í•˜ì—¬, ì‹œìŠ¤í…œì˜ ìœ ì§€ë³´ìˆ˜ì„±ê³¼ í™•ì¥ì„±ì„ ë†’ì´ëŠ” ì„¤ê³„ ë°©ì‹ì…ë‹ˆë‹¤.

*   **ì£¼ìš” ê³„ì¸µ**:
    1.  **Controller (Presentation Layer)**:
        *   **ì±…ì„**: HTTP ìš”ì²­ì„ ë°›ê³ , ì‘ë‹µì„ ë³´ëƒ„.
        *   **ì—­í• **: ì‚¬ìš©ìì˜ ì…ë ¥ì„ ê²€ì¦í•˜ê³ , ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬ë¥¼ **ì„œë¹„ìŠ¤ ê³„ì¸µ**ì— ìœ„ì„.

    2.  **Service (Business Layer)**:
        *   **ì±…ì„**: ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ **í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§** ìˆ˜í–‰.
        *   **ì—­í• **: ì—¬ëŸ¬ Repositoryë¥¼ ì¡°í•©í•˜ì—¬ í•˜ë‚˜ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ê¸°ëŠ¥ì„ ì™„ì„±í•˜ê±°ë‚˜, **íŠ¸ëœì­ì…˜**ì„ ê´€ë¦¬.

    3.  **Repository (Persistence/Data Access Layer)**:
        *   **ì±…ì„**: ë°ì´í„°ë² ì´ìŠ¤ì— ì§ì ‘ ì ‘ê·¼í•˜ì—¬ ë°ì´í„°ë¥¼ CRUD.
        *   **ì—­í• **: `JpaRepository`ë¥¼ í†µí•´ ë°ì´í„°ì˜ ì˜ì†ì„±ì„ ì²˜ë¦¬.

---

### âœ… 2. DTO (Data Transfer Object)ì˜ ì—­í• ê³¼ í•„ìš”ì„±

*   **DTO**ë€ ê³„ì¸µ ê°„ì— **ë°ì´í„°ë¥¼ ì „ë‹¬(Transfer)**í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ê°ì²´ì…ë‹ˆë‹¤.

*   **ì™œ ì—”í‹°í‹°(Entity)ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ë©´ ì•ˆ ë˜ëŠ”ê°€?**
    1.  **API ìŠ¤í™ì˜ ë¶ˆì•ˆì •ì„±**: ì—”í‹°í‹°ëŠ” DB ìŠ¤í‚¤ë§ˆì™€ 1:1ë¡œ ë§¤í•‘ë©ë‹ˆë‹¤. ì—”í‹°í‹° í•„ë“œ ë³€ê²½ ì‹œ, API ì‘ë‹µì´ ê·¸ëŒ€ë¡œ ë³€ê²½ë˜ì–´ í´ë¼ì´ì–¸íŠ¸ ì•±ì— ì˜¤ë¥˜ë¥¼ ìœ ë°œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    2.  **ë¶ˆí•„ìš”í•œ ì •ë³´ ë…¸ì¶œ**: ì—”í‹°í‹°ì—ëŠ” ë¹„ë°€ë²ˆí˜¸ë‚˜ ë‚´ë¶€ ê´€ë¦¬ìš© í•„ë“œ ë“± ì™¸ë¶€ì— ë…¸ì¶œë˜ë©´ ì•ˆ ë˜ëŠ” ë¯¼ê°í•œ ì •ë³´ê°€ í¬í•¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    3.  **ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ ë¬¸ì œ**: ì–‘ë°©í–¥ìœ¼ë¡œ ë§¤í•‘ëœ ì—”í‹°í‹°ë¥¼ JSONìœ¼ë¡œ ë³€í™˜í•  ë•Œ, **ë¬´í•œ ë£¨í”„**ì— ë¹ ì ¸ ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš°ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    4.  **ìš”ì²­/ì‘ë‹µê³¼ ì—”í‹°í‹°ì˜ ë¶ˆì¼ì¹˜**: íšŒì›ê°€ì… ìš”ì²­ ì‹œ í•„ìš”í•œ ë°ì´í„°ì™€ ì‹¤ì œ `User` ì—”í‹°í‹°ì˜ í•„ë“œê°€ ì •í™•íˆ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.

#### â• DTOì˜ í™œìš©

*   **Request DTO**: ì»¨íŠ¸ë¡¤ëŸ¬ê°€ í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° **ìš”ì²­**ì„ ë°›ì„ ë•Œ ì‚¬ìš©í•˜ëŠ” DTO. `@Valid`ë¥¼ í†µí•œ ìœ íš¨ì„± ê²€ì¦ ë¡œì§ì„ í¬í•¨.
*   **Response DTO**: ì»¨íŠ¸ë¡¤ëŸ¬ê°€ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ **ì‘ë‹µ**ì„ ë³´ë‚¼ ë•Œ ì‚¬ìš©í•˜ëŠ” DTO. ì—”í‹°í‹°ì—ì„œ í•„ìš”í•œ ì •ë³´ë§Œ ì„ ë³„í•˜ì—¬ ë‹´ìŒ.

```java
// ê²Œì‹œê¸€ ìƒì„±ì„ ìœ„í•œ Request DTO
@Getter
@NoArgsConstructor
public class PostCreateRequest {
    private String title;
    private String content;

    // DTOë¥¼ Entityë¡œ ë³€í™˜í•˜ëŠ” ë©”ì„œë“œ
    public Post toEntity() {
        return new Post(this.title, this.content);
    }
}

// ê²Œì‹œê¸€ ì¡°íšŒë¥¼ ìœ„í•œ Response DTO
@Getter
public class PostResponse {
    private Long id;
    private String title;
    private String content;
    private LocalDateTime createdAt;

    // Entityë¥¼ DTOë¡œ ë³€í™˜í•˜ëŠ” ìƒì„±ì
    public PostResponse(Post post) {
        this.id = post.getId();
        this.title = post.getTitle();
        this.content = post.getContent();
        this.createdAt = post.getCreatedAt();
    }
}
```

---

### âœ… 3. ì„œë¹„ìŠ¤(Service) ê³„ì¸µ êµ¬í˜„

*   ì„œë¹„ìŠ¤ ê³„ì¸µì€ ì»¨íŠ¸ë¡¤ëŸ¬ì™€ ë¦¬í¬ì§€í† ë¦¬ ì‚¬ì´ì˜ **ì¤‘ì¬ì** ì—­í• ì„ í•˜ë©°, ì‹¤ì œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.

*   **ì£¼ìš” ì–´ë…¸í…Œì´ì…˜**:
    *   **`@Service`**: ì´ í´ë˜ìŠ¤ê°€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë‹´ë‹¹í•˜ëŠ” ì„œë¹„ìŠ¤ ê³„ì¸µì˜ ì»´í¬ë„ŒíŠ¸ì„ì„ Springì— ì•Œë¦½ë‹ˆë‹¤.
    *   **`@Transactional`**: ë©”ì„œë“œë‚˜ í´ë˜ìŠ¤ì— íŠ¸ëœì­ì…˜ì„ ì ìš©í•©ë‹ˆë‹¤. ë©”ì„œë“œ ì‹¤í–‰ ì¤‘ ì˜ˆì™¸ ë°œìƒ ì‹œ, ëª¨ë“  DB ì‘ì—…ì„ ë¡¤ë°±í•˜ì—¬ ë°ì´í„° ì¼ê´€ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.
        *   **`@Transactional(readOnly = true)`**: ì¡°íšŒ(SELECT)ë§Œ í•˜ëŠ” ë©”ì„œë“œì— ì ìš©í•˜ì—¬ ì„±ëŠ¥ì„ ìµœì í™”.
    *   **`@RequiredArgsConstructor`**: `final`ë¡œ ì„ ì–¸ëœ í•„ë“œë¥¼ ìœ„í•œ ìƒì„±ìë¥¼ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì£¼ì–´, **ìƒì„±ì ì£¼ì…**ì„ ê¹”ë”í•˜ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆê²Œ ë•ëŠ” Lombok ì–´ë…¸í…Œì´ì…˜.

```java
package com.example.myproject.service;

import com.example.myproject.domain.Post;
import com.example.myproject.dto.PostCreateRequest;
import com.example.myproject.dto.PostResponse;
import com.example.myproject.repository.PostRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
import java.util.stream.Collectors;

@Service
@RequiredArgsConstructor // final í•„ë“œì— ëŒ€í•œ ìƒì„±ì ìë™ ìƒì„±
@Transactional(readOnly = true) // í´ë˜ìŠ¤ ì „ì²´ì— ì½ê¸° ì „ìš© íŠ¸ëœì­ì…˜ ê¸°ë³¸ ì ìš©
public class PostService {

    private final PostRepository postRepository; // ìƒì„±ì ì£¼ì…

    // ê²Œì‹œê¸€ ìƒì„± (ì“°ê¸° ì‘ì—…ì´ë¯€ë¡œ @Transactionalë¡œ ë®ì–´ì“°ê¸°)
    @Transactional
    public Long createPost(PostCreateRequest request) {
        Post newPost = request.toEntity();
        Post savedPost = postRepository.save(newPost);
        return savedPost.getId();
    }

    // ë‹¨ì¼ ê²Œì‹œê¸€ ì¡°íšŒ
    public PostResponse findPostById(Long id) {
        Post post = postRepository.findById(id)
                .orElseThrow(() -> new IllegalArgumentException("ê²Œì‹œê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. id=" + id));
        return new PostResponse(post);
    }

    // ëª¨ë“  ê²Œì‹œê¸€ ì¡°íšŒ
    public List<PostResponse> findAllPosts() {
        return postRepository.findAll().stream()
                .map(PostResponse::new) // .map(post -> new PostResponse(post)) ì™€ ë™ì¼
                .collect(Collectors.toList());
    }
}
```

---

### âœ… 4. ì»¨íŠ¸ë¡¤ëŸ¬(Controller) ê³„ì¸µ êµ¬í˜„

*   ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì„œë¹„ìŠ¤ ê³„ì¸µì„ í˜¸ì¶œí•˜ê³ , ê·¸ ê²°ê³¼ë¥¼ ë°›ì•„ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ HTTP ì‘ë‹µì„ ë³´ëƒ…ë‹ˆë‹¤.

```java
package com.example.myproject.controller;

import com.example.myproject.dto.PostCreateRequest;
import com.example.myproject.dto.PostResponse;
import com.example.myproject.service.PostService;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.net.URI;
import java.util.List;

@RestController
@RequiredArgsConstructor
@RequestMapping("/api/posts")
public class PostController {

    private final PostService postService;

    @PostMapping
    public ResponseEntity<Void> createPost(@RequestBody PostCreateRequest request) {
        Long postId = postService.createPost(request);
        // ìƒì„±ëœ ë¦¬ì†ŒìŠ¤ì˜ ìœ„ì¹˜(URI)ë¥¼ í—¤ë”ì— ë‹´ì•„ 201 Created ì‘ë‹µ
        return ResponseEntity.created(URI.create("/api/posts/" + postId)).build();
    }

    @GetMapping("/{id}")
    public ResponseEntity<PostResponse> getPost(@PathVariable Long id) {
        PostResponse post = postService.findPostById(id);
        return ResponseEntity.ok(post);
    }

    @GetMapping
    public ResponseEntity<List<PostResponse>> getAllPosts() {
        List<PostResponse> posts = postService.findAllPosts();
        return ResponseEntity.ok(posts);
    }
}
```

---

### ğŸ“Œ ìš”ì•½

*   Spring ì• í”Œë¦¬ì¼€ì´ì…˜ì€ **Controller - Service - Repository**ì˜ **ê³„ì¸µí˜• ì•„í‚¤í…ì²˜**ë¥¼ ë”°ë¥´ë©°, ê° ê³„ì¸µì€ ëª…í™•í•œ ì±…ì„ì„ ê°€ì§‘ë‹ˆë‹¤.
*   **ì—”í‹°í‹°ë¥¼ API ê³„ì¸µì— ì§ì ‘ ë…¸ì¶œí•˜ëŠ” ê²ƒì€ ë§¤ìš° ìœ„í—˜**í•˜ë©°, ë°˜ë“œì‹œ **Request/Response DTO**ë¥¼ ì‚¬ìš©í•˜ì—¬ ê³„ì¸µ ê°„ ë°ì´í„°ë¥¼ ì•ˆì „í•˜ê³  ìœ ì—°í•˜ê²Œ ì „ë‹¬í•´ì•¼ í•©ë‹ˆë‹¤.
*   **ì„œë¹„ìŠ¤ ê³„ì¸µ**ì€ `@Service` ì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ êµ¬í˜„í•˜ê³ , **`@Transactional`** ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ë°ì´í„°ì˜ ì¼ê´€ì„±ì„ ë³´ì¥í•˜ëŠ” í•µì‹¬ì ì¸ ì—­í• ì„ í•©ë‹ˆë‹¤.
*   **ì»¨íŠ¸ë¡¤ëŸ¬**ëŠ” ì„œë¹„ìŠ¤ ê³„ì¸µì˜ ê²°ê³¼ë¥¼ ë°›ì•„, `ResponseEntity`ë¥¼ í†µí•´ ì ì ˆí•œ **HTTP ìƒíƒœ ì½”ë“œ**ì™€ í•¨ê»˜ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì‘ë‹µí•©ë‹ˆë‹¤.