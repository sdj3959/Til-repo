## 0806 μ¤ν”„λ§ μ‹νλ¦¬ν‹° κΈ°λ° νμ›κ°€μ…/λ΅κ·ΈμΈ κµ¬ν„

---

### β… νμ›κ°€μ… κΈ°λ¥ κµ¬ν„ (Controller, Service, DTO)

*   **νμ›κ°€μ…** ν”„λ΅μ„Έμ¤μ κΈ°λ³Έ κ³¨κ²©μ„ κµ¬ν„ν–μµλ‹λ‹¤. Spring MVCμ ν•µμ‹¬ μ»΄ν¬λ„νΈμΈ **Controller, Service, DTO(Data Transfer Object)**λ¥Ό μ‚¬μ©ν•μ—¬ μ—­ν• μ„ λ¶„λ¦¬ν•κ³  κΈ°λ¥μ„ κµ¬ν„ν–μµλ‹λ‹¤.

*   **`AuthController`**: ν΄λΌμ΄μ–ΈνΈμ HTTP μ”μ²­(`@PostMapping("/signup")`)μ„ λ°›μ•„λ“¤μ΄λ” μ§„μ…μ μ…λ‹λ‹¤. `@RequestBody`λ΅ λ°›μ€ JSON λ°μ΄ν„°λ¥Ό `SignUpRequest` DTOλ΅ λ³€ν™ν•κ³ , `@Valid`λ¥Ό ν†µν•΄ μ ν¨μ„± κ²€μ‚¬λ¥Ό μν–‰ν• λ’¤ `UserService`μ— μ²λ¦¬λ¥Ό μ„μ„ν•©λ‹λ‹¤.
*   **`UserService`**: μ‹¤μ  λΉ„μ¦λ‹μ¤ λ΅μ§(νμ› μ •λ³΄ μ €μ¥, μ¤‘λ³µ ν™•μΈ λ“±)μ„ μ²λ¦¬ν•λ” ν•µμ‹¬ κ³„μΈµμ…λ‹λ‹¤.
*   **`SignUpRequest` (DTO)**: ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° λ°›μ€ νμ›κ°€μ… λ°μ΄ν„°λ¥Ό λ‹΄λ” κ°μ²΄μ…λ‹λ‹¤. `@NotBlank`, `@Email` λ“±μ μ ν¨μ„± κ²€μ¦ μ–΄λ…Έν…μ΄μ…μ„ μ μ©ν•μ—¬, Controller λ‹¨μ—μ„ λ°μ΄ν„°μ μ ν¨μ„±μ„ 1μ°¨μ μΌλ΅ λ³΄μ¥ν•©λ‹λ‹¤.

---

### β… Spring Security μ μ© λ° λΉ„λ°€λ²νΈ μ•”νΈν™”

*   μ‚¬μ©μμ λ―Όκ° μ •λ³΄μΈ λΉ„λ°€λ²νΈλ¥Ό μ•μ „ν•κ² μ €μ¥ν•κΈ° μ„ν•΄ **Spring Security**λ¥Ό λ„μ…ν•κ³  **λΉ„λ°€λ²νΈ μ•”νΈν™”**λ¥Ό μ μ©ν–μµλ‹λ‹¤. ν‰λ¬Έ λΉ„λ°€λ²νΈλ¥Ό DBμ— μ €μ¥ν•λ” κ²ƒμ€ μ‹¬κ°ν• λ³΄μ• μ·¨μ•½μ μ…λ‹λ‹¤.

#### β• `PasswordEncoder`

*   **κ°λ…**: λΉ„λ°€λ²νΈλ¥Ό **λ‹¨λ°©ν–¥μΌλ΅ ν•΄μ‹(Hash)**ν•μ—¬ μ•”νΈν™”ν•λ” Spring Securityμ μΈν„°νμ΄μ¤μ…λ‹λ‹¤. ν•΄μ‹λ κ°’μ€ λ³µνΈν™”κ°€ λ¶κ°€λ¥ν•λ©°, λ€μ‹  μ‚¬μ©μκ°€ μ…λ ¥ν• λΉ„λ°€λ²νΈλ¥Ό λ™μΌν• λ°©μ‹μΌλ΅ ν•΄μ‹ν•μ—¬ DBμ— μ €μ¥λ κ°’κ³Ό λΉ„κµ(`matches()`)ν•λ” λ°©μ‹μΌλ΅ μΈμ¦μ„ μν–‰ν•©λ‹λ‹¤.
*   **κµ¬ν„**: `BCryptPasswordEncoder`λ¥Ό `Bean`μΌλ΅ λ“±λ΅ν•μ—¬ ν”„λ΅μ νΈ μ „λ°μ—μ„ μ£Όμ…λ°›μ•„ μ‚¬μ©ν•λ„λ΅ μ„¤μ •ν–μµλ‹λ‹¤. BCryptλ” ν„μ¬ μ‚°μ—… ν‘μ¤€μΌλ΅ λ„λ¦¬ μ‚¬μ©λλ” κ°•λ ¥ν• ν•΄μ‹ μ•κ³ λ¦¬μ¦μ…λ‹λ‹¤.

```java
// PasswordEncoderConfig.java - Bean λ“±λ΅
@Configuration
public class PasswordEncoderConfig {
    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}

// UserService.java - νμ›κ°€μ… μ‹ μ•”νΈν™” μ μ©
User user = User.builder()
        .username(request.getUsername())
        .password(passwordEncoder.encode(request.getPassword())) // λΉ„λ°€λ²νΈλ¥Ό μ•”νΈν™”ν•μ—¬ μ €μ¥
        .email(request.getEmail())
        .build();
userRepository.save(user);
```

---

### β… λ΅κ·ΈμΈ κΈ°λ¥ κµ¬ν„ λ° API μ¶”κ°€

*   νμ›κ°€μ… κΈ°λ¥μ— μ΄μ–΄ **λ΅κ·ΈμΈ κΈ°λ¥**μ„ κµ¬ν„ν–μµλ‹λ‹¤. μ‚¬μ©μκ°€ μ…λ ¥ν• μ‹λ³„μ(μ•„μ΄λ”” λλ” μ΄λ©”μΌ)μ™€ λΉ„λ°€λ²νΈλ¥Ό κ²€μ¦ν•μ—¬ μΈμ¦μ„ μ²λ¦¬ν•©λ‹λ‹¤.

#### β• λ΅κ·ΈμΈ μ²λ¦¬ λ΅μ§

1.  **`LoginRequest` (DTO)**: λ΅κ·ΈμΈμ— ν•„μ”ν• μ‚¬μ©μ μ΄λ¦„/μ΄λ©”μΌκ³Ό λΉ„λ°€λ²νΈλ¥Ό λ‹΄λ” κ°μ²΄μ…λ‹λ‹¤.
2.  **`UserService`μ `authenticate` λ©”μ„λ“**:
    *   μ „λ‹¬λ°›μ€ μ‚¬μ©μ μ΄λ¦„ λλ” μ΄λ©”μΌλ΅ DBμ—μ„ μ‚¬μ©μλ¥Ό μ΅°νν•©λ‹λ‹¤.
    *   μ‚¬μ©μκ°€ μ΅΄μ¬ν•μ§€ μ•μΌλ©΄ μμ™Έλ¥Ό λ°μƒμ‹ν‚µλ‹λ‹¤.
    *   μ‚¬μ©μκ°€ μ΅΄μ¬ν•λ©΄, `PasswordEncoder.matches()` λ©”μ„λ“λ¥Ό μ‚¬μ©ν•μ—¬ **ν΄λΌμ΄μ–ΈνΈκ°€ λ³΄λ‚Έ ν‰λ¬Έ λΉ„λ°€λ²νΈ**μ™€ **DBμ— μ €μ¥λ μ•”νΈν™”λ λΉ„λ°€λ²νΈ**λ¥Ό λΉ„κµν•©λ‹λ‹¤.
    *   κ²€μ¦μ— μ„±κ³µν•λ©΄ μ‚¬μ©μ μ •λ³΄λ¥Ό λ°ν™ν•κ³ , μ‹¤ν¨ν•λ©΄ λΉ„λ°€λ²νΈ λ¶μΌμΉ μμ™Έλ¥Ό λ°μƒμ‹ν‚µλ‹λ‹¤.
3.  **`AuthController`μ `login` λ©”μ„λ“**: `LoginRequest`λ¥Ό λ°›μ•„ `UserService`μ— μΈμ¦μ„ μ„μ„ν•κ³ , μ„±κ³µ μ‹ `ApiResponse`μ— λ‹΄μ•„ μ‘λ‹µν•©λ‹λ‹¤.

---

### β… μΌκ΄€λ API μ‘λ‹µ ν•μ‹ μ„¤κ³„: `ApiResponse`

*   ν΄λΌμ΄μ–ΈνΈμ—κ² μΌκ΄€λκ³  μμΈ΅ κ°€λ¥ν• μ‘λ‹µμ„ μ κ³µν•κΈ° μ„ν•΄ **κ³µν†µ μ‘λ‹µ λνΌ(Wrapper) ν΄λμ¤**μΈ `ApiResponse<T>`λ¥Ό λ„μ…ν–μµλ‹λ‹¤. μ΄λ¥Ό ν†µν•΄ μ„±κ³µ/μ‹¤ν¨ μ—¬λ¶€, λ©”μ‹μ§€, λ°μ΄ν„°λ¥Ό ν‘μ¤€ν™”λ κµ¬μ΅°λ΅ μ „λ‹¬ν•  μ μμµλ‹λ‹¤.

| ν•„λ“      | μ„¤λ…                               | μμ‹                                 |
| --------- | ---------------------------------- | ------------------------------------ |
| `code`    | μ‘λ‹µ μƒνƒλ¥Ό λ‚νƒ€λ‚΄λ” μ½”λ“ (e.g., 200) | `200`                                |
| `message` | μ‘λ‹µμ— λ€ν• μ„¤λ… λ©”μ‹μ§€            | `"νμ›κ°€μ…μ΄ μ„±κ³µμ μΌλ΅ μ™„λ£λμ—μµλ‹λ‹¤."` |
| `data`    | μ‹¤μ  μ‘λ‹µ λ°μ΄ν„° (Generic Type `T`)  | `UserResponse` κ°μ²΄ λλ” `null`        |

*   μ΄ κµ¬μ΅°λ¥Ό ν†µν•΄ λ¨λ“  API μ‘λ‹µμ΄ λ™μΌν• ν•μ‹μ„ κ°–κ² λμ–΄ ν”„λ΅ νΈμ—”λ“μ—μ„μ λ°μ΄ν„° μ²λ¦¬κ°€ λ§¤μ° μ©μ΄ν•΄μ§‘λ‹λ‹¤.

---

### β… μ „μ—­ μμ™Έ μ²λ¦¬: `GlobalExceptionHandler`

*   μ• ν”λ¦¬μΌ€μ΄μ… μ „μ—­μ—μ„ λ°μƒν•λ” μμ™Έλ¥Ό ν• κ³³μ—μ„ μ¤‘μ•™ κ΄€λ¦¬ν•κΈ° μ„ν•΄ **`@RestControllerAdvice`** μ–΄λ…Έν…μ΄μ…μ„ μ‚¬μ©ν• `GlobalExceptionHandler`λ¥Ό κµ¬ν„ν–μµλ‹λ‹¤. μ΄λ¥Ό ν†µν•΄ Controllerλ§λ‹¤ μ¤‘λ³µλ `try-catch` λΈ”λ΅μ„ μ‘μ„±ν•  ν•„μ”κ°€ μ—†μ–΄μ§€κ³  μ½”λ“μ κ°€λ…μ„±κ³Ό μ μ§€λ³΄μμ„±μ΄ ν–¥μƒλ©λ‹λ‹¤.

#### β• μ»¤μ¤ν…€ μμ™Έμ™€ μ—λ¬ μ½”λ“

*   **`BusinessException`**: λΉ„μ¦λ‹μ¤ λ΅μ§ μƒμ μμ™Έ μƒν™©(e.g., μ‚¬μ©μλ… μ¤‘λ³µ, μ΄λ©”μΌ μ¤‘λ³µ)μ„ λ‚νƒ€λ‚΄κΈ° μ„ν• μ»¤μ¤ν…€ μμ™Έ ν΄λμ¤μ…λ‹λ‹¤.
*   **`ErrorCode` (Enum)**: μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„ λ°μƒν•  μ μλ” λ¨λ“  μ—λ¬ μƒν™©μ„ `HttpStatus`, `μ½”λ“`, `λ©”μ‹μ§€`μ™€ ν•¨κ» μ—΄κ±°ν•μΌλ΅ μ •μν•©λ‹λ‹¤. μ΄λ¥Ό ν†µν•΄ μ—λ¬ κ΄€λ¦¬κ°€ μ²΄κ³„μ μΌλ΅ μ΄λ£¨μ–΄μ§‘λ‹λ‹¤.
*   **`ErrorResponse` (DTO)**: ν΄λΌμ΄μ–ΈνΈμ—κ² λ°ν™ν•  μ—λ¬ μ‘λ‹µμ ν•μ‹μ„ μ •μν• DTOμ…λ‹λ‹¤.

#### β• μ ν¨μ„± κ²€μ¦(`@Valid`) μμ™Έ μ²λ¦¬

*   `@Valid` μ–΄λ…Έν…μ΄μ…μ„ ν†µκ³Όν•μ§€ λ»ν•λ©΄ `MethodArgumentNotValidException`μ΄ λ°μƒν•©λ‹λ‹¤. `GlobalExceptionHandler`μ—μ„ μ΄ μμ™Έλ¥Ό μ²λ¦¬ν•μ—¬, μ–΄λ–¤ ν•„λ“κ°€ μ–΄λ–¤ κ·μΉ™μ„ μ„λ°ν–λ”μ§€ μƒμ„Έν• μ •λ³΄λ¥Ό λ‹΄μ€ `ValidationError` κ°μ²΄λ¥Ό `ErrorResponse`μ— ν¬ν•¨μ‹μΌ μ‘λ‹µν•©λ‹λ‹¤.
*   **`@JsonInclude(JsonInclude.Include.NON_NULL)`**: μ‘λ‹µ DTOλ¥Ό JSONμΌλ΅ λ³€ν™ν•  λ•, κ°’μ΄ `null`μΈ ν•„λ“λ” κ²°κ³Όμ—μ„ μ μ™Έμ‹ν‚¤λ” μ–΄λ…Έν…μ΄μ…μ…λ‹λ‹¤. μ΄λ¥Ό ν†µν•΄ λ¶ν•„μ”ν• μ •λ³΄ μ—†μ΄ κΉ”λ”ν• μ‘λ‹µμ„ λ³΄λ‚Ό μ μμµλ‹λ‹¤.

```java
// GlobalExceptionHandler.java μμ‹
@RestControllerAdvice
public class GlobalExceptionHandler {

    // λΉ„μ¦λ‹μ¤ μμ™Έ μ²λ¦¬
    @ExceptionHandler(BusinessException.class)
    protected ResponseEntity<ErrorResponse> handleBusinessException(BusinessException e) {
        // ... ErrorCodeλ¥Ό κΈ°λ°μΌλ΅ ErrorResponse μƒμ„± λ° λ°ν™
    }

    // μ ν¨μ„± κ²€μ¦ μμ™Έ μ²λ¦¬
    @ExceptionHandler(MethodArgumentNotValidException.class)
    protected ResponseEntity<ErrorResponse> handleMethodArgumentNotValidException(MethodArgumentNotValidException e) {
        // ... BindingResultμ—μ„ ν•„λ“λ³„ μ—λ¬ μ •λ³΄λ¥Ό μ¶”μ¶ν•μ—¬ ErrorResponse μƒμ„± λ° λ°ν™
    }
}
```

---

### π“ μ”μ•½

*   **νμ›κ°€μ…/λ΅κ·ΈμΈ**μ κΈ°λ³Έ λ΅μ§μ„ **Controller-Service-DTO** ν¨ν„΄μΌλ΅ κµ¬ν„ν–μµλ‹λ‹¤.
*   **Spring Security**μ™€ **`PasswordEncoder`**λ¥Ό λ„μ…ν•μ—¬ μ‚¬μ©μ λΉ„λ°€λ²νΈλ¥Ό μ•μ „ν•κ² μ•”νΈν™”ν–μµλ‹λ‹¤.
*   **`ApiResponse`** ν΄λμ¤λ¥Ό ν†µν•΄ λ¨λ“  API μ‘λ‹µμ„ ν‘μ¤€ν™”ν•μ—¬ μΌκ΄€μ„±μ„ ν™•λ³΄ν–μµλ‹λ‹¤.
*   **`@RestControllerAdvice`**λ¥Ό μ‚¬μ©ν• **`GlobalExceptionHandler`**λ¥Ό κµ¬ν„ν•μ—¬ μμ™Έ μ²λ¦¬λ¥Ό μ¤‘μ•™ μ§‘μ¤‘ν™”ν–μµλ‹λ‹¤.
*   **`BusinessException`**κ³Ό **`ErrorCode`** Enumμ„ ν™μ©ν•μ—¬ λΉ„μ¦λ‹μ¤ μμ™Έλ¥Ό μ²΄κ³„μ μΌλ΅ κ΄€λ¦¬ν•κ³ , `@Valid` μμ™Έ μ²λ¦¬λ΅ μ‚¬μ©μμ—κ² μΉμ ν• μ—λ¬ λ©”μ‹μ§€λ¥Ό μ κ³µν•  μ μκ² λμ—μµλ‹λ‹¤.
