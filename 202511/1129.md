## 1129 Spring Boot ν…μ¤νΈ μ‹¬ν™”: DB ν†µν•© ν…μ¤νΈμ™€ Testcontainers

---

### β… 1. λ°μ΄ν„°λ² μ΄μ¤ ν…μ¤νΈμ μΆ…λ¥μ™€ ν•κ³„

*   λ°μ΄ν„°λ² μ΄μ¤ μ—°λ™ μ½”λ“λ¥Ό ν…μ¤νΈν•λ” λ°©λ²•μ€ ν¬κ² λ‘ κ°€μ§€λ΅ λ‚λ‰©λ‹λ‹¤.

1.  **`@DataJpaTest` (μΈλ©”λ¨λ¦¬ DB μ‚¬μ©)**:
    *   **κ°λ…**: μ‹¤μ  DBκ°€ μ•„λ‹, H2μ™€ κ°™μ€ **μΈλ©”λ¨λ¦¬(In-memory) λ°μ΄ν„°λ² μ΄μ¤**λ¥Ό μ‚¬μ©ν•μ—¬ Repository κ³„μΈµμ„ ν…μ¤νΈν•λ” λ°©μ‹μ…λ‹λ‹¤.
    *   **μ¥μ **: μ„¤μ •μ΄ κ°„νΈν•κ³ , μ‹¤ν–‰ μ†λ„κ°€ λΉ λ¥΄λ©°, κ° ν…μ¤νΈ ν›„ μλ™ λ΅¤λ°±λμ–΄ ν…μ¤νΈ κ°„ κ²©λ¦¬λ¥Ό λ³΄μ¥ν•©λ‹λ‹¤.
    *   **ν•κ³„μ **:
        *   **SQL λ°©μ–Έ(Dialect)μ μ°¨μ΄**: μΈλ©”λ¨λ¦¬ DB(H2)μ SQL λ¬Έλ²•κ³Ό μ‹¤μ  μ΄μ DB(MySQL, PostgreSQL λ“±)μ λ¬Έλ²•μ΄ λ―Έλ¬ν•κ² λ‹¤λ¦…λ‹λ‹¤. H2μ—μ„λ” μ„±κ³µν• μΏΌλ¦¬κ°€ μ‹¤μ  DBμ—μ„λ” μ‹¤ν¨ν•  μ μμµλ‹λ‹¤.
        *   **DB κ³ μ  κΈ°λ¥ ν…μ¤νΈ λ¶κ°€**: μ‹¤μ  DBκ°€ μ κ³µν•λ” κ³ μ ν• ν•¨μλ‚ λ°μ΄ν„° νƒ€μ… λ“±μ„ ν…μ¤νΈν•  μ μ—†μµλ‹λ‹¤.
        *   **κ²°λ΅ **: `@DataJpaTest`λ” κ°„λ‹¨ν• CRUDλ¥Ό κ²€μ¦ν•λ” λ°λ” μ μ©ν•μ§€λ§, μ΄μ ν™κ²½κ³Όμ μ™„λ²½ν• λ™μΌμ„±μ„ λ³΄μ¥ν•μ§€λ” λ»ν•©λ‹λ‹¤.

2.  **`@SpringBootTest` (μ‹¤μ  DB μ—°κ²°)**:
    *   **κ°λ…**: ν…μ¤νΈμ© λ΅μ»¬ DBλ‚ κ°λ° DBμ— μ§μ ‘ μ—°κ²°ν•μ—¬ ν†µν•© ν…μ¤νΈλ¥Ό μν–‰ν•λ” λ°©μ‹μ…λ‹λ‹¤.
    *   **μ¥μ **: μ΄μ ν™κ²½κ³Ό κ°€μ¥ μ μ‚¬ν• ν™κ²½μ—μ„ ν…μ¤νΈν•μ—¬ μ‹ λΆ°λ„κ°€ λ†’μµλ‹λ‹¤.
    *   **ν•κ³„μ **:
        *   **ν™κ²½ μμ΅΄μ„±**: λ¨λ“  κ°λ°μμ™€ CI μ„λ²„μ— λ™μΌν• λ²„μ „μ DBλ¥Ό μ„¤μΉν•κ³  μ„¤μ •ν•΄μ•Ό ν•λ” λ²κ±°λ΅μ›€μ΄ μμµλ‹λ‹¤.
        *   **ν…μ¤νΈ κ²©λ¦¬ λ¬Έμ **: ν…μ¤νΈ μ‹¤ν–‰ μ‹ DB μƒνƒκ°€ μκµ¬μ μΌλ΅ λ³€κ²½λμ–΄, λ‹¤λ¥Έ ν…μ¤νΈμ— μν–¥μ„ μ¤„ μ μμµλ‹λ‹¤. (`@Transactional`λ΅ λ΅¤λ°±ν•  μ μμ§€λ§ ν•κ³„κ°€ μμ)

---

### β… 2. Testcontainers: ν…μ¤νΈλ¥Ό μ„ν• Docker μ»¨ν…μ΄λ„

*   **Testcontainers**λ” JUnit ν…μ¤νΈ μ½”λ“ λ‚΄μ—μ„ **Docker μ»¨ν…μ΄λ„λ¥Ό ν”„λ΅κ·Έλλ§¤ν‹±ν•κ² μƒμ„±ν•κ³  κ΄€λ¦¬**ν•  μ μκ² ν•΄μ£Όλ” Java λΌμ΄λΈλ¬λ¦¬μ…λ‹λ‹¤.

*   **ν•µμ‹¬ μ•„μ΄λ””μ–΄**: ν…μ¤νΈκ°€ μ‹¤ν–‰λ  λ•λ§λ‹¤, ν•„μ”ν• μ†ν”„νΈμ›¨μ–΄(DB, Redis, Kafka λ“±)κ°€ μ„¤μΉλ **Docker μ»¨ν…μ΄λ„λ¥Ό μ¦‰μ„μ—μ„ λ„μ°κ³ **, ν…μ¤νΈκ°€ λλ‚λ©΄ **μ»¨ν…μ΄λ„λ¥Ό μλ™μΌλ΅ νκΈ°**ν•©λ‹λ‹¤.

#### β• Testcontainersμ μ¥μ 

1.  **μ΄μ ν™κ²½κ³Όμ λ™μΌμ„±**: μ‹¤μ  μ΄μ ν™κ²½μ—μ„ μ‚¬μ©ν•  **λ™μΌν• λ²„μ „μ λ°μ΄ν„°λ² μ΄μ¤(e.g., MySQL 8.0) Docker μ΄λ―Έμ§€**λ¥Ό μ‚¬μ©ν•μ—¬ ν…μ¤νΈν•λ―€λ΅, SQL λ°©μ–Έ μ°¨μ΄ λ“±μ λ¬Έμ λ¥Ό μ›μ²μ μΌλ΅ ν•΄κ²°ν•©λ‹λ‹¤.
2.  **ν™κ²½ λ…λ¦½μ„±**: κ°λ°μμ λ΅μ»¬ λ¨Έμ‹ μ΄λ‚ CI μ„λ²„μ— **λ³„λ„λ΅ λ°μ΄ν„°λ² μ΄μ¤λ¥Ό μ„¤μΉν•  ν•„μ”κ°€ μ—†μµλ‹λ‹¤.** μ¤μ§ Dockerλ§ μ„¤μΉλμ–΄ μμΌλ©΄ λ©λ‹λ‹¤.
3.  **μ™„λ²½ν• ν…μ¤νΈ κ²©λ¦¬**: κ° ν…μ¤νΈ ν΄λμ¤(λλ” λ©”μ„λ“)λ§λ‹¤ **κΉ¨λ—ν•κ³  λ…λ¦½μ μΈ λ°μ΄ν„°λ² μ΄μ¤ μ»¨ν…μ΄λ„**λ¥Ό λ„μ›μ„ μ‚¬μ©ν•λ―€λ΅, ν…μ¤νΈ κ°„μ— λ°μ΄ν„°κ°€ μ¤μ—Όλ  κ±±μ •μ΄ μ „ν€ μ—†μµλ‹λ‹¤.

---

### β… 3. `@SpringBootTest`μ™€ Testcontainersλ¥Ό μ΄μ©ν• ν†µν•© ν…μ¤νΈ

*   `@SpringBootTest`μ "μ‹¤μ  ν™κ²½κ³Ό μ μ‚¬ν•¨"μ΄λΌλ” μ¥μ κ³Ό, Testcontainersμ "ν™κ²½ λ…λ¦½μ„± λ° κ²©λ¦¬"λΌλ” μ¥μ μ„ κ²°ν•©ν•μ—¬, κ°€μ¥ μ΄μƒμ μΈ λ°μ΄ν„°λ² μ΄μ¤ ν†µν•© ν…μ¤νΈ ν™κ²½μ„ κµ¬μ¶•ν•  μ μμµλ‹λ‹¤.

#### β• κµ¬ν„ νλ¦„

1.  **μμ΅΄μ„± μ¶”κ°€**: `build.gradle`μ— `testcontainers`μ™€ μ‚¬μ©ν•  λ°μ΄ν„°λ² μ΄μ¤(e.g., `mysql`)μ— λ€ν• μμ΅΄μ„±μ„ μ¶”κ°€ν•©λ‹λ‹¤.

2.  **ν…μ¤νΈ μ»¨ν…μ΄λ„ μ„¤μ •**:
    *   `@SpringBootTest`κ°€ λ¶™μ€ ν…μ¤νΈ ν΄λμ¤μ— `@Testcontainers` μ–΄λ…Έν…μ΄μ…μ„ μ¶”κ°€ν•μ—¬ Testcontainers κΈ°λ¥μ„ ν™μ„±ν™”ν•©λ‹λ‹¤.
    *   `@Container` μ–΄λ…Έν…μ΄μ…μ„ μ‚¬μ©ν•μ—¬, ν…μ¤νΈ μ¤‘μ— μ‹¤ν–‰ν•  Docker μ»¨ν…μ΄λ„λ¥Ό μ •μν•©λ‹λ‹¤. `MySQLContainer`μ™€ κ°™μ€ κ³µμ‹ μ§€μ› λ¨λ“μ„ μ‚¬μ©ν•λ©΄ μ„¤μ •μ΄ λ§¤μ° κ°„νΈν•©λ‹λ‹¤.
    *   `@DynamicPropertySource`λ¥Ό μ‚¬μ©ν•μ—¬, **λ™μ μΌλ΅ μƒμ„±λ μ»¨ν…μ΄λ„μ μ ‘μ† μ •λ³΄**(JDBC URL, username, password)λ¥Ό Spring Bootμ `application.yml` μ„¤μ •κ°’μ— **λ°νƒ€μ„μ— μ£Όμ…**ν•©λ‹λ‹¤.

    ```java
    @SpringBootTest
    @Testcontainers // Testcontainers ν™μ„±ν™”
    class MyIntegrationTest {

        // staticμΌλ΅ μ„ μ–Έν•μ—¬ ν΄λμ¤ λ‚΄ λ¨λ“  ν…μ¤νΈμ—μ„ μ»¨ν…μ΄λ„λ¥Ό κ³µμ 
        @Container
        static MySQLContainer<?> mySQLContainer = new MySQLContainer<>("mysql:8.0");

        // λ™μ μΌλ΅ μƒμ„±λ μ»¨ν…μ΄λ„μ μ ‘μ† μ •λ³΄λ¥Ό Spring μ„¤μ •μ— μ£Όμ…
        @DynamicPropertySource
        static void configureProperties(DynamicPropertyRegistry registry) {
            registry.add("spring.datasource.url", mySQLContainer::getJdbcUrl);
            registry.add("spring.datasource.username", mySQLContainer::getUsername);
            registry.add("spring.datasource.password", mySQLContainer::getPassword);
        }

        @Autowired
        private MyService myService;

        @Test
        void integrationTest() {
            // μ΄ ν…μ¤νΈλ” μ‹¤μ  MySQL 8.0 Docker μ»¨ν…μ΄λ„ μ„μ—μ„ μ‹¤ν–‰λ¨
            // ...
        }
    }
    ```

3.  **ν…μ¤νΈ μ‹¤ν–‰**:
    *   JUnit ν…μ¤νΈλ¥Ό μ‹¤ν–‰ν•λ©΄, Testcontainersλ” λ¨Όμ € Dockerλ¥Ό ν†µν•΄ MySQL μ»¨ν…μ΄λ„λ¥Ό μ‹μ‘ν•©λ‹λ‹¤.
    *   `@DynamicPropertySource`κ°€ μ»¨ν…μ΄λ„μ λ™μ  ν¬νΈμ™€ μκ²© μ¦λ…μ„ Springμ DataSource μ„¤μ •μ— λ®μ–΄μ”λ‹λ‹¤.
    *   `@SpringBootTest`λ” μ΄ μ„¤μ •μΌλ΅ Spring μ»¨ν…μ΄λ„λ¥Ό κµ¬λ™ν•κ³ , μ‹¤μ  DB μ»¤λ„¥μ…μ„ λ§Ίμµλ‹λ‹¤.
    *   ν…μ¤νΈ λ©”μ„λ“κ°€ μ‹¤ν–‰λ©λ‹λ‹¤.
    *   λ¨λ“  ν…μ¤νΈκ°€ μ™„λ£λλ©΄, Testcontainersκ°€ μλ™μΌλ΅ MySQL μ»¨ν…μ΄λ„λ¥Ό μ¤‘μ§€ν•κ³  μ‚­μ ν•©λ‹λ‹¤.

---

### π“ μ”μ•½

*   `@DataJpaTest`λ” λΉ λ¥΄μ§€λ§ **μ΄μ ν™κ²½κ³Όμ μ°¨μ΄**λΌλ” ν•κ³„κ°€ μκ³ , μ‹¤μ  DBλ¥Ό μ‚¬μ©ν•λ” `@SpringBootTest`λ” **ν™κ²½ μμ΅΄μ„±**κ³Ό **κ²©λ¦¬**μ— μ–΄λ ¤μ›€μ΄ μμµλ‹λ‹¤.
*   **Testcontainers**λ” ν…μ¤νΈ μ‹¤ν–‰ μ‹ **Docker μ»¨ν…μ΄λ„λ¥Ό λ™μ μΌλ΅ μƒμ„±**ν•μ—¬, **μ΄μ ν™κ²½κ³Ό λ™μΌ**ν•λ©΄μ„λ„ **μ™„λ²½ν•κ² κ²©λ¦¬λ** ν…μ¤νΈ ν™κ²½μ„ μ κ³µν•λ” νμ‹ μ μΈ μ†”λ£¨μ…μ…λ‹λ‹¤.
*   `@SpringBootTest`μ™€ **Testcontainers**λ¥Ό ν•¨κ» μ‚¬μ©ν•λ©΄, `@DynamicPropertySource`λ¥Ό ν†µν•΄ λ™μ μΌλ΅ μƒμ„±λ DB μ»¨ν…μ΄λ„μ μ ‘μ† μ •λ³΄λ¥Ό Springμ— μ£Όμ…ν•μ—¬, **μ‹ λΆ°λ„ λ†’κ³  μ¬ν„ κ°€λ¥ν•** λ°μ΄ν„°λ² μ΄μ¤ ν†µν•© ν…μ¤νΈλ¥Ό μ‘μ„±ν•  μ μμµλ‹λ‹¤.