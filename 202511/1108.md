## 1108 Spring Boot: JPA μ—°λ™κ³Ό ν…μ¤νΈ μ½”λ“ μ‘μ„±

---

### β… 1. Spring Data JPA: λ°μ΄ν„° μ ‘κ·Ό κ³„μΈµμ μλ™ν™”

*   **Spring Data JPA**λ” JPA(Java Persistence API)λ¥Ό λ” μ‰½κ³  ν¨μ¨μ μΌλ΅ μ‚¬μ©ν•  μ μλ„λ΅ λ„μ™€μ£Όλ” Spring ν”„λ μ„μ›ν¬μ λ¨λ“μ…λ‹λ‹¤. λ³µμ΅ν• λ°μ΄ν„° μ ‘κ·Ό κ³„μΈµ(DAO) κµ¬ν„μ„ μλ™ν™”ν•μ—¬ κ°λ° μƒμ‚°μ„±μ„ νκΈ°μ μΌλ΅ λ†’μ—¬μ¤λ‹λ‹¤.

#### β• `JpaRepository` μΈν„°νμ΄μ¤

*   **μ—­ν• **: λ°μ΄ν„°λ² μ΄μ¤μ— λ€ν• CRUD(μƒμ„±, μ΅°ν, μμ •, μ‚­μ ) μ‘μ—…μ„ μ„ν• μΈν„°νμ΄μ¤μ…λ‹λ‹¤.
*   **μ‚¬μ©λ²•**: κ°λ°μλ” `JpaRepository<Entity, ID>` μΈν„°νμ΄μ¤λ¥Ό μƒμ†λ°›λ” μμ‹ λ§μ Repository μΈν„°νμ΄μ¤λ¥Ό μ •μν•κΈ°λ§ ν•λ©΄ λ©λ‹λ‹¤.
    ```java
    public interface UserRepository extends JpaRepository<User, Long> {
        // μ΄ μΈν„°νμ΄μ¤λ¥Ό μ •μν•λ” κ²ƒλ§μΌλ΅...
    }
    ```
*   **μ κ³µλλ” κΈ°λ¥**: μ„μ™€ κ°™μ΄ μΈν„°νμ΄μ¤λ§ μ •μν•΄λ„, Spring Data JPAλ” λ°νƒ€μ„μ— μλ™μΌλ΅ κµ¬ν„μ²΄λ¥Ό λ§λ“¤μ–΄ λ‹¤μκ³Ό κ°™μ€ κΈ°λ³Έ λ©”μ„λ“λ“¤μ„ μ κ³µν•©λ‹λ‹¤.
    *   `save(entity)`: λ°μ΄ν„° μ €μ¥ (INSERT) λ° μμ • (UPDATE)
    *   `findById(id)`: IDλ΅ λ‹¨κ±΄ μ΅°ν (SELECT)
    *   `findAll()`: λ¨λ“  λ°μ΄ν„° μ΅°ν (SELECT)
    *   `deleteById(id)`: IDλ΅ λ°μ΄ν„° μ‚­μ  (DELETE)
    *   `count()`: μ „μ²΄ λ°μ΄ν„° κ°μ μ΅°ν

#### β• μΏΌλ¦¬ λ©”μ„λ“ (Query Methods)

*   **κ°λ…**: μ •ν•΄μ§„ λ…λ… κ·μΉ™μ— λ”°λΌ λ©”μ„λ“ μ΄λ¦„μ„ μ‘μ„±ν•λ©΄, Spring Data JPAκ°€ ν•΄λ‹Ή μ΄λ¦„μ— λ§λ” JPQL(Java Persistence Query Language) μΏΌλ¦¬λ¥Ό **μλ™μΌλ΅ μƒμ„±**ν•μ—¬ μ‹¤ν–‰ν•λ” κΈ°λ¥μ…λ‹λ‹¤.
*   **κ·μΉ™**: `findBy`, `countBy` λ“±μ μ ‘λ‘μ‚¬ λ’¤μ— μ—”ν‹°ν‹°μ ν•„λ“ μ΄λ¦„μ„ μ΅°ν•©ν•μ—¬ μ‘μ„±ν•©λ‹λ‹¤.
*   **μμ‹**:
    ```java
    public interface UserRepository extends JpaRepository<User, Long> {
        // SELECT * FROM users WHERE username = ?
        Optional<User> findByUsername(String username);

        // SELECT * FROM users WHERE email = ? AND status = ?
        List<User> findByEmailAndStatus(String email, UserStatus status);

        // SELECT COUNT(*) FROM users WHERE status = ?
        long countByStatus(UserStatus status);
    }
    ```
*   **μ¥μ **: κ°„λ‹¨ν• μ΅°ν μΏΌλ¦¬λ” SQLμ΄λ‚ JPQLμ„ ν• μ¤„λ„ μ‘μ„±ν•μ§€ μ•κ³ , λ©”μ„λ“ μ„ μ–Έλ§μΌλ΅ ν•΄κ²°ν•  μ μμ–΄ λ§¤μ° νΈλ¦¬ν•©λ‹λ‹¤.

---

### β… 2. JPA μ—”ν‹°ν‹°(Entity)μ™€ λ°μ΄ν„°λ² μ΄μ¤ λ§¤ν•‘

*   **μ—”ν‹°ν‹°**: λ°μ΄ν„°λ² μ΄μ¤μ **ν…μ΄λΈ”κ³Ό μ§μ ‘μ μΌλ΅ λ§¤ν•‘**λλ” Java κ°μ²΄μ…λ‹λ‹¤. JPAλ” μ΄ μ—”ν‹°ν‹° κ°μ²΄μ λ³€ν™”λ¥Ό κ°μ§€ν•μ—¬ λ°μ΄ν„°λ² μ΄μ¤μ— μλ™μΌλ΅ SQLμ„ μ‹¤ν–‰ν•©λ‹λ‹¤.

#### β• μ£Όμ” μ–΄λ…Έν…μ΄μ… λ³µμµ

*   **`@Entity`**: μ΄ ν΄λμ¤κ°€ JPAκ°€ κ΄€λ¦¬ν•λ” μ—”ν‹°ν‹°μ„μ„ μ„ μ–Έν•©λ‹λ‹¤.
*   **`@Table`**: μ—”ν‹°ν‹°μ™€ λ§¤ν•‘λ  ν…μ΄λΈ”μ μ΄λ¦„μ„ μ§€μ •ν•©λ‹λ‹¤.
*   **`@Id`**: ν…μ΄λΈ”μ **κΈ°λ³Έ ν‚¤(Primary Key)**μ— ν•΄λ‹Ήν•λ” ν•„λ“μ„μ„ λ‚νƒ€λƒ…λ‹λ‹¤.
*   **`@GeneratedValue(strategy = GenerationType.IDENTITY)`**: κΈ°λ³Έ ν‚¤ κ°’μ„ λ°μ΄ν„°λ² μ΄μ¤(e.g., MySQLμ `AUTO_INCREMENT`)κ°€ μλ™μΌλ΅ μƒμ„±ν•λ„λ΅ μ„μ„ν•©λ‹λ‹¤.
*   **`@Column`**: ν•„λ“μ™€ λ§¤ν•‘λ  μ»¬λΌμ μ„Έλ¶€ μ†μ„±(μ΄λ¦„, nullable, unique λ“±)μ„ μ§€μ •ν•©λ‹λ‹¤.

---

### β… 3. ν…μ¤νΈ μ½”λ“ μ‘μ„±μ μ¤‘μ”μ„±κ³Ό Spring Boot ν…μ¤νΈ

*   **ν…μ¤νΈ μ½”λ“**λ” λ‚΄κ°€ μ‘μ„±ν• μ½”λ“κ°€ μλ„ν• λ€λ΅ μ •ν™•ν•κ² λ™μ‘ν•λ”μ§€λ¥Ό κ²€μ¦ν•λ” μ½”λ“μ…λ‹λ‹¤. ν…μ¤νΈ μ½”λ“λ” μ½”λ“μ **μ•μ •μ„±**μ„ λ³΄μ¥ν•κ³ , λ¦¬ν©ν† λ§ μ‹ **μμ‹ κ°**μ„ μ£Όλ©°, μ½”λ“ μμ²΄λ¥Ό μ„¤λ…ν•λ” **λ¬Έμ„**μ μ—­ν• μ„ ν•©λ‹λ‹¤.

*   **Spring Boot Test**: Spring Bootλ” ν…μ¤νΈλ¥Ό λ§¤μ° μ‰½κ² μ‘μ„±ν•  μ μλ„λ΅ κ°•λ ¥ν• ν…μ¤νΈ μ§€μ› κΈ°λ¥μ„ μ κ³µν•©λ‹λ‹¤.

#### β• μ£Όμ” ν…μ¤νΈ μ–΄λ…Έν…μ΄μ…

1.  **`@SpringBootTest`**:
    *   **ν†µν•© ν…μ¤νΈ(Integration Test)**λ¥Ό μ„ν• ν•µμ‹¬ μ–΄λ…Έν…μ΄μ…μ…λ‹λ‹¤.
    *   μ‹¤μ  μ• ν”λ¦¬μΌ€μ΄μ…κ³Ό κ±°μ λ™μΌν• ν™κ²½(λ¨λ“  Beanμ„ Spring μ»¨ν…μ΄λ„μ— λ΅λ“)μ„ κµ¬μ„±ν•μ—¬ ν…μ¤νΈλ¥Ό μ§„ν–‰ν•©λ‹λ‹¤.
    *   **μ¥μ **: μ‹¤μ  μ΄μ ν™κ²½κ³Ό κ°€μ¥ μ μ‚¬ν• μ΅°κ±΄μ—μ„ ν…μ¤νΈν•  μ μμ–΄ μ‹ λΆ°λ„κ°€ λ†’μµλ‹λ‹¤.
    *   **λ‹¨μ **: λ¨λ“  Beanμ„ λ΅λ“ν•λ―€λ΅ μƒλ€μ μΌλ΅ λ¬΄κ²κ³  μ‹¤ν–‰ μ†λ„κ°€ λλ¦½λ‹λ‹¤.

2.  **`@DataJpaTest`**:
    *   **JPA κ΄€λ ¨ κ³„μΈµ(Repository)λ§**μ„ ν…μ¤νΈν•κΈ° μ„ν• **μ¬λΌμ΄μ¤ ν…μ¤νΈ(Slice Test)** μ–΄λ…Έν…μ΄μ…μ…λ‹λ‹¤.
    *   JPAμ™€ κ΄€λ ¨λ Beanλ“¤(`JpaRepository`, `EntityManager` λ“±)λ§ μ»¨ν…μ΄λ„μ— λ΅λ“ν•λ―€λ΅ `@SpringBootTest`λ³΄λ‹¤ ν›¨μ”¬ κ°€λ³κ³  λΉ λ¦…λ‹λ‹¤.
    *   **νΉμ§•**:
        *   κΈ°λ³Έμ μΌλ΅ **μΈλ©”λ¨λ¦¬ λ°μ΄ν„°λ² μ΄μ¤(In-memory DB, e.g., H2)**λ¥Ό μ‚¬μ©ν•μ—¬ ν…μ¤νΈλ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤. (μ‹¤μ  DB μ¤μ—Ό λ°©μ§€)
        *   κ° ν…μ¤νΈ λ©”μ„λ“κ°€ λλ‚  λ•λ§λ‹¤, ν•΄λ‹Ή λ©”μ„λ“μ—μ„ μν–‰λ λ¨λ“  λ°μ΄ν„°λ² μ΄μ¤ μ‘μ—…μ„ **μλ™μΌλ΅ λ΅¤λ°±(Rollback)**ν•©λ‹λ‹¤. μ΄λ¥Ό ν†µν•΄ κ° ν…μ¤νΈλ” μ„λ΅μ—κ² μν–¥μ„ μ£Όμ§€ μ•κ³  λ…λ¦½μ μΌλ΅ μ‹¤ν–‰λ  μ μμµλ‹λ‹¤.

#### β• JUnit 5μ™€ AssertJλ¥Ό μ΄μ©ν• ν…μ¤νΈ μ½”λ“ μμ‹

*   **JUnit 5**: Java μ§„μμ ν‘μ¤€ ν…μ¤νΈ ν”„λ μ„μ›ν¬. `@Test`, `@DisplayName` λ“±μ μ–΄λ…Έν…μ΄μ…μ„ μ κ³µ.
*   **AssertJ**: ν…μ¤νΈ κ²°κ³Όμ κ²€μ¦μ„ μ„ν• λΌμ΄λΈλ¬λ¦¬. `assertThat(κ²°κ³Ό).isEqualTo(κΈ°λ€κ°’)`κ³Ό κ°™μ΄ μμ—°μ¤λ¬μ΄ λ¬Έλ²•μ„ μ κ³µ.

```java
@DataJpaTest // JPA κ³„μΈµ ν…μ¤νΈ
class UserRepositoryTest {

    @Autowired
    private UserRepository userRepository;

    @Test
    @DisplayName("μ‚¬μ©μ μ €μ¥ λ° μ΅°ν ν…μ¤νΈ")
    void saveAndFindUserTest() {
        // given - ν…μ¤νΈ μ¤€λΉ„
        User newUser = new User("testuser", "password123");

        // when - ν…μ¤νΈ μ‹¤ν–‰
        User savedUser = userRepository.save(newUser);
        Optional<User> foundUser = userRepository.findById(savedUser.getId());

        // then - κ²°κ³Ό κ²€μ¦
        assertThat(foundUser).isPresent(); // foundUserκ°€ μ΅΄μ¬ν•λ”μ§€ ν™•μΈ
        assertThat(foundUser.get().getUsername()).isEqualTo("testuser");
    }
}
```

---

### π“ μ”μ•½

*   **Spring Data JPA**λ” `JpaRepository` μΈν„°νμ΄μ¤μ™€ **μΏΌλ¦¬ λ©”μ„λ“**λ¥Ό ν†µν•΄ λ°μ΄ν„° μ ‘κ·Ό κ³„μΈµμ κ°λ°μ„ κ·Ήμ μΌλ΅ λ‹¨μν™”ν•©λ‹λ‹¤.
*   **JPA μ—”ν‹°ν‹°**λ” `@Entity`, `@Id` λ“±μ μ–΄λ…Έν…μ΄μ…μ„ ν†µν•΄ λ°μ΄ν„°λ² μ΄μ¤ ν…μ΄λΈ”κ³Ό λ§¤ν•‘λ©λ‹λ‹¤.
*   **ν…μ¤νΈ μ½”λ“**λ” μ†ν”„νΈμ›¨μ–΄μ μ•μ •μ„±μ„ λ³΄μ¥ν•λ” ν•„μμ μΈ μ”μ†μ΄λ©°, Spring Bootλ” μ΄λ¥Ό μ„ν• κ°•λ ¥ν• μ§€μ›μ„ μ κ³µν•©λ‹λ‹¤.
*   **`@SpringBootTest`**λ” **ν†µν•© ν…μ¤νΈ**μ—, **`@DataJpaTest`**λ” **JPA κ³„μΈµμ λ‹¨μ„ ν…μ¤νΈ**μ— μ‚¬μ©λλ©°, κ°€λ³κ³  λΉ λ¥΄λ©° μλ™ λ΅¤λ°± κΈ°λ¥μ„ μ κ³µν•μ—¬ Repository ν…μ¤νΈμ— λ§¤μ° μ μ©ν•©λ‹λ‹¤.
